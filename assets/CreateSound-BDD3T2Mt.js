import{_ as G,r as c,a as r,z as n,o as a,d as s,B as V,b as o,I as F,J as K,c as N,w as l,A as x,e as u,f,C as Pe,n as ae,N as Q,R as Le,p as Ee,q as Fe,S as je,y as Oe,u as qe,O as le,T as ne,U as He,V as Je}from"./index-oBlTSEMj.js";import{t as Ke}from"./time-tY07ncrd.js";import{u as ce}from"./token-BcuPBtfw.js";import{M as P}from"./Input-BKAO9olY.js";import{A as Qe}from"./AudioPlayer-DWaYlVtx.js";import{a as Ge,c as We,d as Xe,e as Ye,f as Ze}from"./mybank-8Z2e_TXj.js";import{i as et}from"./request-CYse1m-U.js";const tt={key:0},st={style:{"font-size":"18px","font-weight":"800","padding-bottom":"10px"}},ot={class:"tag"},at={style:{display:"flex","flex-direction":"row",gap:"10px"}},lt={style:{"font-weight":"520",color:"#71717a"}},nt={__name:"Recent",setup(h){const k=c([{voiceId:70,voiceImage:"https://loremflickr.com/400/400?lock=567532027855895",voiceName:"曲志明",voiceDescription:"例面求上。果圆相称斗织是。开电年。同利算术极七等被来。问广十世。",voiceCreationTime:"2024-04-22 00:28:31",voiceIsCollected:!0,voiceSamples:[{sampleId:83,sampleIsPlaying:!1,sampleTitle:"拨伟大快但是脊梁",sampleText:"consectetur",sampleUrl:"https://nutritious-designation.com/"}]}]);return ce(),(D,v)=>{const I=r("el-empty"),b=r("el-image"),T=r("el-col"),j=r("el-tag"),m=r("el-icon"),O=r("el-row");return a(),n(F,null,[v[2]||(v[2]=s("h2",null,"最近活动",-1)),k.value.length===0?(a(),n("div",tt,[o(I,{description:"暂无数据"})])):V("",!0),(a(!0),n(F,null,K(k.value,U=>(a(),N(O,{key:U.voiceId,class:"voice-item"},{default:l(()=>[o(T,{span:5,style:{display:"flex","align-items":"center","justify-content":"center"}},{default:l(()=>[o(b,{style:{width:"75px",height:"75px","border-radius":"10px"},src:U.voiceImage,fit:"cover"},null,8,["src"])]),_:2},1024),o(T,{span:19},{default:l(()=>[s("div",st,x(U.voiceName),1),s("div",ot,[o(j,{type:"success",round:"",effect:"dark",style:{width:"50px","font-weight":"1000"}},{default:l(()=>v[0]||(v[0]=[u("成功")])),_:1}),v[1]||(v[1]=s("div",{class:"dot"},null,-1)),s("div",at,[o(m,{size:"20",style:{color:"#6b7280"}},{default:l(()=>[o(f(Pe))]),_:1}),s("span",lt,x(f(Ke)(U.voiceCreationTime)),1)])])]),_:2},1024)]),_:2},1024))),128))],64)}}},it=G(nt,[["__scopeId","data-v-61a850a9"]]),ct={class:"steps"},ie={__name:"Step",props:{currentStep:Number},setup(h){const k=h;return(D,v)=>{const I=r("el-divider");return a(),n("div",ct,[s("div",{class:ae(["step",{active:k.currentStep===1}])},"1",2),v[0]||(v[0]=s("div",{class:"detail"},[s("div",{class:"title"},"步骤1"),u(" 声音详情 ")],-1)),o(I,{class:"thick-divider"}),s("div",{class:ae(["step",{active:k.currentStep===2}])},"2",2),v[1]||(v[1]=s("div",{class:"detail"},[s("div",{class:"title"},"步骤2"),u(" 示例音频 ")],-1))])}}},rt={class:"info-container"},dt={key:0,class:"info-item"},ut={__name:"Store",setup(h){const k=c(["山区的瀑布，在长期的水流冲击下，下方形成深潭，潭水清澈且富含氧气，为多种鱼类和水生植物创造了适宜的生存环境，体现了自然现象产生的独特生态价值。","草原上的季节性河流，在枯水期形成的浅滩和湿地，吸引了大量候鸟在此停歇觅食，成为候鸟迁徙途中的重要补给站，表明自然的季节性变化能带来生态上的便利。","高山上的积雪，在春季融化后形成溪流，为山下的农田和森林提供了灌溉水源，滋养了众多生物，这显示出自然的冰雪循环对生态系统的重要滋养作用。","热带雨林中的暴雨，频繁的降水使土壤表面形成许多小水坑，这些水坑成为蛙类和小型水生生物的繁殖场所，说明自然降水能创造特定的生态繁衍环境。","北方冬季的大雪，积雪覆盖大地，为土壤起到保温作用，同时雪水融化后为春季植物生长提供水分，体现了自然降雪对生态的多重益处。","潮汐的涨落，在海岸边形成了潮间带，这里富含各种贝类和藻类，为许多涉禽提供了丰富的食物来源，表明自然的潮汐现象能构建独特的生态食物链。","石灰岩地区的溶洞，洞内独特的环境为蝙蝠提供了栖息和繁殖的场所，同时溶洞内的地下河也孕育了特殊的水生生物，说明自然的岩溶地貌能形成特殊的生态系统。","山顶的强风，使得树木生长形态扭曲，但这种独特的树形为一些鸟类提供了更好的筑巢支撑点，显示出自然环境对生态的意外塑造。","河流的改道，遗弃的旧河道形成了牛轭湖，牛轭湖为各种水生动植物提供了相对独立的生态空间，丰富了区域的生态多样性。","戈壁滩上的砾石，经过长时间的风化，表面形成一层黑色的“沙漠漆”，这种特殊的物质能吸收热量，为一些沙漠植物种子的萌发提供适宜温度，说明自然风化产物对生态有积极意义。","春季的沙尘暴，沙尘携带的矿物质在飘落后成为海洋浮游生物的重要养分，促进了海洋生态系统的初级生产力，体现了看似有害的自然现象背后的生态益处。","针叶林地区的落叶，在地面堆积腐烂后形成酸性土壤，这种土壤适合蓝莓等喜酸植物的生长，表明自然的落叶分解能营造特定的植物生长环境。","盐湖在干旱季节水分蒸发，盐分结晶析出，形成独特的盐滩景观，盐滩周边的特殊环境为耐盐植物和卤虫等生物提供了生存家园，说明自然的干湿变化能创造特殊生态。","山地的云雾，常常笼罩在山腰，为一些喜阴植物提供了湿润且凉爽的环境，使这些植物能在特定海拔区域良好生长，显示出自然云雾对生态的调节作用。","热带草原的野火，虽然烧毁部分草木，但也清除了地面的枯枝落叶，促进了新草的生长，同时吸引了食草动物前来觅食，带动了整个生态系统的活力，表明自然野火对生态有积极推动。","河流入海口的泥沙淤积，形成了广阔的河口三角洲，三角洲土地肥沃，为众多候鸟和鱼类提供了丰富的食物和栖息地，说明自然的泥沙堆积能创造重要的生态区域。","冻原地区的永冻层，在夏季部分融化，形成许多小的湿地和浅湖，为北极地区的鸟类和水禽提供了繁殖和觅食的场所，体现了自然冻土融化对生态的积极影响。"]);function D(b,T){return b=Math.ceil(b),T=Math.floor(T),Math.floor(Math.random()*(T-b+1))+b}const v=D(0,16),I=Q(()=>k.value[v]||"");return(b,T)=>(a(),n("div",rt,[I.value?(a(),n("div",dt,x(I.value),1)):V("",!0)]))}},pt=G(ut,[["__scopeId","data-v-4ec65fdf"]]),vt=Le("step",()=>{const h=c(1);function k(){h.value=2}function D(){h.value=1}return{step:h,incrementStep:k,reduceStep:D}}),mt=h=>et.post("/common/audio",h),ft={class:"form-section"},_t={class:"radio"},yt={key:0,style:{"font-size":"small",color:"#6b748b"}},gt={key:1,style:{"font-size":"small",color:"#6b748b"}},kt={class:"form-section"},bt={class:"avatar"},ht={class:"upload-box"},St=["src"],wt={class:"form-section"},It={class:"form-section"},Tt={class:"form-section"},Ct={key:0},Ut={class:"audio-upload"},zt={class:"audio-player"},xt={class:"audio-upload"},Dt={class:"size"},Mt=["onClick"],Rt=["onClick"],$t={class:"time-picker"},Nt={class:"loadHeader"},Vt={key:0,class:"icon"},At={key:1,class:"icon"},Bt={key:2,class:"icon"},Pt={key:2,class:"btnssecond"},Lt={class:"audio-container"},Et={class:"card-header"},Ft={style:{"font-weight":"600"}},jt={class:"myinput"},Ot={class:"add-button-container"},qt={class:"btnssecond"},Ht={__name:"CreateSound",setup(h){const k=ce(),D=c("输入音频样本标题"),v=c("输入音频样本文本"),I=c("textarea"),b=c("#f5f5f5"),T=c("填写音频描述"),j=c("3"),m=c([{sampleId:"",sampleTitle:"",sampleText:"",sampleUrl:"",sampleIsPlaying:!1}]),O=()=>{m.value.push({sampleTitle:"",sampleText:"",sampleUrl:"",sampleIsPlaying:!1})},U=qe(),W=Ee(),A=W.query?W.query.id:void 0,re=t=>{const e=m.value[t];e.audio&&(e.audio.pause(),e.audio.currentTime=0),m.value.splice(t,1)};function de(t,e){m.value[t].sampleTitle=e}function ue(t,e){m.value[t].sampleText=e}const y=c([]),L=c(!1),$=c(null),q=c([]),X=c(),Y=c(),pe=async()=>{X.value=new Date;try{const t=await navigator.mediaDevices.getUserMedia({audio:!0});$.value=new MediaRecorder(t),q.value=[],$.value.ondataavailable=e=>{e.data.size>0&&q.value.push(e.data)},$.value.start(),L.value=!0,$.value.onstop=()=>{const e=new Blob(q.value,{type:"audio/mp3"});e.value=e,L.value=!1,t.getTracks().forEach(i=>i.stop()),me(e)}}catch(t){console.error("获取音频流失败：",t)}};function ve(t,e){const i=new Date(t),S=new Date(e),_=Math.abs(S.getTime()-i.getTime());return Math.floor(_/1e3)}const me=async t=>{Y.value=new Date;const e={name:`record-${y.value.length+1}.mp3`,url:URL.createObjectURL(t),blob:t,duration:`${ve(X.value,Y.value)}s`,size:Z(t.size),file:new File([t],`record-${y.value.length+1}.mp3`,{type:"audio/mp3"})};y.value.unshift(e)},fe=()=>{$.value&&($.value.stop(),L.value=!1)},Z=t=>`${(t/1024).toFixed(2)} KB`,_e=t=>isNaN(t)||t===1/0?"未知":`${Math.floor(t)}s`,ye=async t=>{const e=URL.createObjectURL(t),i=new Audio(URL.createObjectURL(t));return await new Promise(S=>{i.addEventListener("loadedmetadata",()=>{const _=i.duration,B=_e(_),E={name:t.name,size:Z(t.size),duration:B,isPlaying:!1,url:e,file:t,actualDuration:_};y.value.push(E),S()})}),!1},g=Fe({}),ee=t=>{const e=y.value[t];g[t]||(g[t]=new Audio(e.url));const i=g[t];e.isPlaying?i.pause():(Object.entries(g).forEach(([S,_])=>{S!=t&&!_.paused&&(_.pause(),y.value[S].isPlaying=!1)}),i.play()),e.isPlaying=!e.isPlaying,i.addEventListener("ended",()=>{e.isPlaying=!1})},te=t=>{g[t]&&(g[t].pause(),g[t].src="",delete g[t]),y.value.splice(t,1)},ge=(t,e)=>{const i=e.value.findIndex(S=>S.name===t.name);i!==-1&&te(i)},se=c("first"),ke=()=>{M.incrementStep()},C=Q(()=>{let t=0;for(const e of y.value){const i=parseInt(e.duration.slice(0,-1),10);t+=i}return t}),be=Q(()=>({10:{style:{color:"#9ca3b3",fontSize:"17px"},label:"最小"},30:{style:{color:"#9ca3b3",fontSize:"17px"},label:"推荐"},90:{style:{color:"#9ca3b3",fontSize:"17px"},label:"最大"}})),he=c("填写声音名称"),Se=c("输入标签");function we(t){p.value.voiceName=t}function Ie(t){p.value.voiceDescription=t}function Te(t){p.value.voiceTag=t}const M=vt(),{step:H}=je(M),J=c(""),p=c({voiceType:"1",voiceImage:"",voiceName:"",voiceDescription:"",voiceTag:""}),Ce=t=>{p.value.voiceImage=t.data},Ue=async()=>{const t=new FormData;for(const e in p.value)t.append(e,p.value[e]);y.value.forEach(e=>{t.append("files",e.file)});for(const[e,i]of t.entries())console.log(`${e}:`,i);try{let e=await Ze(t);m.value=e.data.sample,J.value=e.data.voiceId,console.log("音频上传成功:",m.value,J.value)}catch(e){console.error("音频上传失败:",e)}},ze=async()=>{await Ue(),y.value=[],Object.keys(g).forEach(t=>{g[t].pause(),g[t].src="",delete g[t]}),M.incrementStep()},xe=()=>{U.push("/mybank"),M.reduceStep()},De=async()=>{U.push("/mybank"),M.reduceStep();const t=m.value.slice(1);await Xe(t)},Me=async()=>{U.push("/mybank"),M.reduceStep();const t=m.value.slice(1);await Ye(t)},Re=async t=>{const e={voiceId:J.value,sampleText:m.value[t].sampleText};let i=await mt(e);m.value[t].sampleUrl=i.data};Oe(async()=>{if(A!==void 0){let t=await Ge(A);p.value=t.data.insertData,m.value=t.data.samples}});const $e=async()=>{await We(p.value),M.incrementStep()};return(t,e)=>{const i=r("el-radio-button"),S=r("el-radio-group"),_=r("el-icon"),B=r("el-upload"),E=r("el-tab-pane"),R=r("el-col"),oe=r("el-row"),Ne=r("el-tabs"),Ve=r("el-slider"),Ae=r("el-button"),Be=r("el-divider");return a(),N(oe,null,{default:l(()=>[f(H)===1?(a(),N(R,{key:0,span:12},{default:l(()=>[e[18]||(e[18]=s("h2",null,"训练新声音",-1)),o(ie,{currentStep:f(H)},null,8,["currentStep"]),s("div",null,[e[17]||(e[17]=s("h3",null,"声音详情",-1)),s("div",null,[s("div",ft,[e[3]||(e[3]=u(" 类型 ")),s("div",_t,[o(S,{modelValue:p.value.voiceType,"onUpdate:modelValue":e[0]||(e[0]=d=>p.value.voiceType=d),size:"large","text-color":"black",fill:"#fafafa"},{default:l(()=>[o(i,{label:"公开",value:"1"}),o(i,{label:"私有",value:"0"})]),_:1},8,["modelValue"])]),p.value.voiceType==="1"?(a(),n("div",yt," 此语音模型将在发现页面中可见，每个人都可以看到。 ")):(a(),n("div",gt,"此语音模型仅对创建者可见，不能共享且不会出现在发现页面。"))]),s("div",kt,[e[5]||(e[5]=u(" 封面图 (可选) ")),s("div",bt,[s("div",ht,[o(B,{class:"avatar-uploader","auto-upload":!0,"show-file-list":!1,action:"/api/common/upload",name:"file",headers:{Authorization:f(k).token.token},"on-success":Ce},{default:l(()=>[p.value.voiceImage?(a(),n("img",{key:0,src:p.value.voiceImage,class:"avatar"},null,8,St)):(a(),N(_,{key:1,class:"avatar-uploader-icon"},{default:l(()=>[o(f(le))]),_:1}))]),_:1},8,["headers"])]),e[4]||(e[4]=s("h4",null,"声音封面图片 (文件最大不超过 2MB)",-1))])]),s("div",wt,[e[6]||(e[6]=u(" 名称 ")),o(P,{message:p.value.voiceName,placeholder:he.value,class:"search-input",color:b.value,"onUpdate:message":we},null,8,["message","placeholder","color"])]),s("div",It,[e[7]||(e[7]=u(" 描述 (可选) ")),o(P,{message:p.value.voiceDescription,placeholder:T.value,color:b.value,type:I.value,"onUpdate:message":Ie},null,8,["message","placeholder","color","type"])]),s("div",Tt,[e[8]||(e[8]=u(" 标签 ")),o(P,{message:p.value.voiceTag,placeholder:Se.value,class:"search-input",color:b.value,"onUpdate:message":Te},null,8,["message","placeholder","color"])])]),f(A)===void 0?(a(),n("div",Ct,[e[16]||(e[16]=s("h3",null,"输入音频",-1)),o(Ne,{modelValue:se.value,"onUpdate:modelValue":e[1]||(e[1]=d=>se.value=d),class:"demo-tabs"},{default:l(()=>[o(E,{label:"上传音频",name:"second"},{default:l(()=>[s("div",Ut,[o(B,{class:"upload-component",accept:"audio/*","before-upload":ye,"file-list":y.value,"on-remove":ge,limit:0},{default:l(()=>e[9]||(e[9]=[s("div",{class:"upload-button"},[s("div",{class:"insert"}),s("h5",null,"添加或删除您的音频文件")],-1)])),_:1},8,["file-list"])])]),_:1}),o(E,{label:"录制音频",name:"first"},{default:l(()=>[s("div",zt,[L.value?(a(),n("div",{key:1,onClick:fe,class:"record"},e[11]||(e[11]=[s("div",{class:"noRecord"},null,-1),u(" 停止录制 ")]))):(a(),n("div",{key:0,onClick:pe,class:"record"},e[10]||(e[10]=[s("div",{class:"inRecord"},null,-1),u(" 点击开始录制 ")]))),e[12]||(e[12]=s("div",{style:{"font-size":"small",color:"#6b7280"}},"*您可以使用自己的文本或下面的建议文本录制您的声音。",-1)),o(pt)])]),_:1}),s("div",xt,[(a(!0),n(F,null,K(y.value,(d,w)=>(a(),N(oe,{key:w,class:"files"},{default:l(()=>[o(R,{span:2,class:"logo"}),o(R,{span:13,class:"file"},{default:l(()=>[u(x(d.name)+" ",1),s("div",Dt,x(d.size),1)]),_:2},1024),o(R,{span:4},{default:l(()=>[u(x(d.duration),1)]),_:2},1024),o(R,{span:4,class:"btns"},{default:l(()=>[d.isPlaying?(a(),n("div",{key:1,class:"on",onClick:z=>ee(w)},null,8,Rt)):(a(),n("div",{key:0,class:"close",onClick:z=>ee(w)},null,8,Mt)),o(_,{onClick:z=>te(w),class:"delete-btn",size:"25"},{default:l(()=>[o(f(ne))]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))])]),_:1},8,["modelValue"]),s("div",$t,[s("div",Nt,[u(" 已上传："+x(C.value)+"s ",1),C.value<=90&&C.value>=10?(a(),n("div",Vt,[o(_,{size:"20",color:"#16a149"},{default:l(()=>[o(f(He))]),_:1}),e[13]||(e[13]=u(" 不错 "))])):V("",!0),C.value>90||C.value<10&&C.value>0?(a(),n("div",At,[o(_,{size:"20",color:"#ef4343"},{default:l(()=>[o(f(Je))]),_:1}),e[14]||(e[14]=u(" 过长/过短 "))])):V("",!0),C.value===0?(a(),n("div",Bt," 推荐 30 秒左右 ")):V("",!0)]),o(Ve,{modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=d=>C.value=d),min:"0",max:"100",step:1,"show-stops":"",marks:be.value,"show-tooltip":!1,"show-button":!1},null,8,["modelValue","marks"]),e[15]||(e[15]=s("div",{class:"tip"},"*提示：最短10秒，最长90秒，推荐30秒",-1))])])):V("",!0),f(A)===void 0?(a(),n("button",{key:1,class:"next-btn",onClick:ze},"创建")):(a(),n("div",Pt,[s("button",{class:"next-btn",onClick:$e},"保存"),s("button",{class:"skip",onClick:ke},"跳过")]))])]),_:1})):(a(),N(R,{key:1,span:12},{default:l(()=>[e[23]||(e[23]=s("h2",null,"训练新声音",-1)),o(ie,{currentStep:f(H)},null,8,["currentStep"]),s("div",null,[e[22]||(e[22]=s("h3",null,"音频样本",-1)),s("div",Lt,[(a(!0),n(F,null,K(m.value,(d,w)=>(a(),n("div",{key:d.sampleId,class:"audio-card"},[s("div",null,[s("div",Et,[s("span",Ft,x(d.sampleTitle===""?"样本"+w:d.sampleTitle),1),o(_,{size:"20",color:"#606672",style:{cursor:"pointer"},onClick:z=>re(w)},{default:l(()=>[o(f(ne))]),_:2},1032,["onClick"])])]),s("div",jt,[o(P,{message:d.sampleTitle,placeholder:D.value,"onUpdate:message":z=>de(w,z)},null,8,["message","placeholder","onUpdate:message"]),o(P,{message:d.sampleText,placeholder:v.value,type:I.value,rows:j.value,"onUpdate:message":z=>ue(w,z)},null,8,["message","placeholder","type","rows","onUpdate:message"]),o(Ae,{color:"#e7e7e8",onClick:z=>Re(w),style:{width:"16%","margin-left":"1%"}},{default:l(()=>e[19]||(e[19]=[s("div",{class:"make"},null,-1),u(" 生成样本 ")])),_:2},1032,["onClick"]),o(Qe,{audioUrl:d.sampleUrl},null,8,["audioUrl"])])]))),128)),s("div",Ot,[s("button",{onClick:O,class:"add-btn"},[o(_,{size:"20",style:{"padding-right":"5px"}},{default:l(()=>[o(f(le))]),_:1}),e[20]||(e[20]=u()),e[21]||(e[21]=s("span",{style:{"font-size":"large"}},"添加音频示例",-1))])]),s("div",qt,[f(A)===void 0?(a(),n("button",{key:0,class:"next-btn",onClick:De},"保存")):(a(),n("button",{key:1,class:"next-btn",onClick:Me},"保存")),s("button",{class:"skip",onClick:xe},"跳过")])])])]),_:1})),o(Be,{direction:"vertical",style:{height:"auto"}}),o(R,{span:11,class:"reactivity"},{default:l(()=>[o(it)]),_:1})]),_:1})}}},Zt=G(Ht,[["__scopeId","data-v-84187e36"]]);export{Zt as default};
