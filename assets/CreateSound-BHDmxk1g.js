import{_ as Y,u as ue,r as i,B as de,b as u,C as n,o,f as s,F as $,e as a,L as q,M as W,c as A,a as l,D as z,g as r,h as f,G as Fe,n as le,Q as X,U as je,d as Oe,z as qe,V as Qe,R as ne,W as ie,X as Ge,Y as ce}from"./index-cpBiw585.js";import{t as He,M as Ke}from"./Select-bCNWJ9kA.js";import{c as We,e as Xe,f as Ye,g as Je,h as Ze,i as et,j as tt}from"./mybank-Cen-hxFa.js";import{M as E}from"./Input-BlekEaNA.js";import{A as st}from"./AudioPlayer-B55bfuQ3.js";import{i as at}from"./request-D1PYwchc.js";/* empty css                                                    */import"./token-Cw1dmRyj.js";const ot={key:0},lt=["onClick"],nt={class:"tag"},it={style:{display:"flex","flex-direction":"row",gap:"10px"}},ct={style:{"font-weight":"520",color:"#71717a"}},rt={__name:"Recent",setup(h){const S=ue(),C=g=>{S.push({path:"/detail",query:{id:g}})},y=i([{voiceId:70,voiceImage:"https://loremflickr.com/400/400?lock=567532027855895",voiceName:"曲志明",voiceDescription:"例面求上。果圆相称斗织是。开电年。同利算术极七等被来。问广十世。",voiceCreationTime:"2024-04-22 00:28:31",voiceIsCollected:!0,voiceSamples:[{sampleId:83,sampleIsPlaying:!1,sampleTitle:"拨伟大快但是脊梁",sampleText:"consectetur",sampleUrl:"https://nutritious-designation.com/"}]}]);return de(async()=>{let g=await We();y.value=g.data}),(g,_)=>{const U=u("el-empty"),v=u("el-image"),F=u("el-col"),Q=u("el-tag"),G=u("el-icon"),B=u("el-row");return o(),n(q,null,[_[2]||(_[2]=s("h2",null,"最近活动",-1)),y.value.length===0?(o(),n("div",ot,[a(U,{description:"暂无数据"})])):$("",!0),(o(!0),n(q,null,W(y.value,M=>(o(),A(B,{key:M.voiceId,class:"voice-item"},{default:l(()=>[a(F,{span:5,style:{display:"flex","align-items":"center","justify-content":"center"}},{default:l(()=>[a(v,{style:{width:"75px",height:"75px","border-radius":"10px"},src:M.voiceImage,fit:"cover"},null,8,["src"])]),_:2},1024),a(F,{span:19},{default:l(()=>[s("div",{style:{"font-size":"18px","font-weight":"800","padding-bottom":"10px",cursor:"pointer"},onClick:N=>C(M.voiceId)},z(M.voiceName),9,lt),s("div",nt,[a(Q,{type:"success",round:"",effect:"dark",style:{width:"50px","font-weight":"1000"}},{default:l(()=>_[0]||(_[0]=[r("成功")])),_:1}),_[1]||(_[1]=s("div",{class:"dot"},null,-1)),s("div",it,[a(G,{size:"20",style:{color:"#6b7280"}},{default:l(()=>[a(f(Fe))]),_:1}),s("span",ct,z(f(He)(M.voiceCreationTime)),1)])])]),_:2},1024)]),_:2},1024))),128))],64)}}},ut=Y(rt,[["__scopeId","data-v-858a627e"]]),dt={class:"steps"},re={__name:"Step",props:{currentStep:Number},setup(h){const S=h;return(C,y)=>{const g=u("el-divider");return o(),n("div",dt,[s("div",{class:le(["step",{active:S.currentStep===1}])},"1",2),y[0]||(y[0]=s("div",{class:"detail"},[s("div",{class:"title"},"步骤1"),r(" 声音详情 ")],-1)),a(g,{class:"thick-divider"}),s("div",{class:le(["step",{active:S.currentStep===2}])},"2",2),y[1]||(y[1]=s("div",{class:"detail"},[s("div",{class:"title"},"步骤2"),r(" 示例音频 ")],-1))])}}},pt={class:"info-container"},vt={key:0,class:"info-item"},mt={__name:"Store",setup(h){const S=i(["山区的瀑布，在长期的水流冲击下，下方形成深潭，潭水清澈且富含氧气，为多种鱼类和水生植物创造了适宜的生存环境，体现了自然现象产生的独特生态价值。","草原上的季节性河流，在枯水期形成的浅滩和湿地，吸引了大量候鸟在此停歇觅食，成为候鸟迁徙途中的重要补给站，表明自然的季节性变化能带来生态上的便利。","高山上的积雪，在春季融化后形成溪流，为山下的农田和森林提供了灌溉水源，滋养了众多生物，这显示出自然的冰雪循环对生态系统的重要滋养作用。","热带雨林中的暴雨，频繁的降水使土壤表面形成许多小水坑，这些水坑成为蛙类和小型水生生物的繁殖场所，说明自然降水能创造特定的生态繁衍环境。","北方冬季的大雪，积雪覆盖大地，为土壤起到保温作用，同时雪水融化后为春季植物生长提供水分，体现了自然降雪对生态的多重益处。","潮汐的涨落，在海岸边形成了潮间带，这里富含各种贝类和藻类，为许多涉禽提供了丰富的食物来源，表明自然的潮汐现象能构建独特的生态食物链。","石灰岩地区的溶洞，洞内独特的环境为蝙蝠提供了栖息和繁殖的场所，同时溶洞内的地下河也孕育了特殊的水生生物，说明自然的岩溶地貌能形成特殊的生态系统。","山顶的强风，使得树木生长形态扭曲，但这种独特的树形为一些鸟类提供了更好的筑巢支撑点，显示出自然环境对生态的意外塑造。","河流的改道，遗弃的旧河道形成了牛轭湖，牛轭湖为各种水生动植物提供了相对独立的生态空间，丰富了区域的生态多样性。","戈壁滩上的砾石，经过长时间的风化，表面形成一层黑色的“沙漠漆”，这种特殊的物质能吸收热量，为一些沙漠植物种子的萌发提供适宜温度，说明自然风化产物对生态有积极意义。","春季的沙尘暴，沙尘携带的矿物质在飘落后成为海洋浮游生物的重要养分，促进了海洋生态系统的初级生产力，体现了看似有害的自然现象背后的生态益处。","针叶林地区的落叶，在地面堆积腐烂后形成酸性土壤，这种土壤适合蓝莓等喜酸植物的生长，表明自然的落叶分解能营造特定的植物生长环境。","盐湖在干旱季节水分蒸发，盐分结晶析出，形成独特的盐滩景观，盐滩周边的特殊环境为耐盐植物和卤虫等生物提供了生存家园，说明自然的干湿变化能创造特殊生态。","山地的云雾，常常笼罩在山腰，为一些喜阴植物提供了湿润且凉爽的环境，使这些植物能在特定海拔区域良好生长，显示出自然云雾对生态的调节作用。","热带草原的野火，虽然烧毁部分草木，但也清除了地面的枯枝落叶，促进了新草的生长，同时吸引了食草动物前来觅食，带动了整个生态系统的活力，表明自然野火对生态有积极推动。","河流入海口的泥沙淤积，形成了广阔的河口三角洲，三角洲土地肥沃，为众多候鸟和鱼类提供了丰富的食物和栖息地，说明自然的泥沙堆积能创造重要的生态区域。","冻原地区的永冻层，在夏季部分融化，形成许多小的湿地和浅湖，为北极地区的鸟类和水禽提供了繁殖和觅食的场所，体现了自然冻土融化对生态的积极影响。"]);function C(_,U){return _=Math.ceil(_),U=Math.floor(U),Math.floor(Math.random()*(U-_+1))+_}const y=C(0,16),g=X(()=>S.value[y]||"");return(_,U)=>(o(),n("div",pt,[g.value?(o(),n("div",vt,z(g.value),1)):$("",!0)]))}},ft=Y(mt,[["__scopeId","data-v-4ec65fdf"]]),_t=je("step",()=>{const h=i(1);function S(){h.value=2}function C(){h.value=1}return{step:h,incrementStep:S,reduceStep:C}}),yt=h=>at.post("/common/audio",h),gt={class:"form-section"},kt={class:"radio"},bt={key:0,style:{"font-size":"small",color:"#6b748b"}},ht={key:1,style:{"font-size":"small",color:"#6b748b"}},St={class:"form-section"},wt={class:"avatar"},It={class:"upload-box"},Tt=["src"],Ct={class:"form-section"},Ut={class:"form-section"},Mt={class:"form-section"},xt={class:"form-section"},zt={key:0},Dt={class:"audio-upload"},Rt={class:"audio-player"},$t={class:"audio-upload"},Nt={class:"size"},Vt=["onClick"],At=["onClick"],Bt={class:"time-picker"},Lt={class:"loadHeader"},Pt={key:0,class:"icon"},Et={key:1,class:"icon"},Ft={key:2,class:"icon"},jt={key:3,class:"icon"},Ot={key:2,class:"btnssecond"},qt={class:"audio-container"},Qt={class:"card-header"},Gt={style:{"font-weight":"600"}},Ht={class:"myinput"},Kt={class:"add-button-container"},Wt={class:"btnssecond"},Xt={__name:"CreateSound",setup(h){const S=i("输入音频样本标题"),C=i("输入音频样本文本"),y=i("textarea"),g=i("#fafafa"),_=i("填写音频描述"),U=i("3"),v=i([{sampleId:"",sampleTitle:"",sampleText:"",sampleUrl:"",sampleIsPlaying:!1}]),F=()=>{v.value.push({sampleTitle:"",sampleText:"",sampleUrl:"",sampleIsPlaying:!1})},Q=i([{value:"1",label:"中文"},{value:"2",label:"English"}]),G=t=>{d.value.voiceLanguage=parseInt(t,10)},B=ue(),M=Oe(),N=M.query?M.query.id:void 0,pe=t=>{const e=v.value[t];e.audio&&(e.audio.pause(),e.audio.currentTime=0),v.value.splice(t,1)};function ve(t,e){v.value[t].sampleTitle=e}function me(t,e){v.value[t].sampleText=e}const k=i([]),j=i(!1),V=i(null),H=i([]),J=i(),Z=i(),fe=async()=>{J.value=new Date;try{const t=await navigator.mediaDevices.getUserMedia({audio:!0});V.value=new MediaRecorder(t),H.value=[],V.value.ondataavailable=e=>{e.data.size>0&&H.value.push(e.data)},V.value.start(),j.value=!0,V.value.onstop=()=>{const e=new Blob(H.value,{type:"audio/mp3"});e.value=e,j.value=!1,t.getTracks().forEach(c=>c.stop()),ye(e)}}catch(t){console.error("获取音频流失败：",t)}};function _e(t,e){const c=new Date(t),w=new Date(e),m=Math.abs(w.getTime()-c.getTime());return Math.floor(m/1e3)}const ye=async t=>{Z.value=new Date;const e={name:`record-${k.value.length+1}.mp3`,url:URL.createObjectURL(t),blob:t,duration:`${_e(J.value,Z.value)}s`,size:ee(t.size),file:new File([t],`record-${k.value.length+1}.mp3`,{type:"audio/mp3"})};k.value.unshift(e)},ge=()=>{V.value&&(V.value.stop(),j.value=!1)},ee=t=>`${(t/1024).toFixed(2)} KB`,ke=t=>isNaN(t)||t===1/0?"未知":`${Math.floor(t)}s`,be=async t=>{const e=URL.createObjectURL(t),c=new Audio(URL.createObjectURL(t));return await new Promise(w=>{c.addEventListener("loadedmetadata",()=>{const m=c.duration,P=ke(m),O={name:t.name,size:ee(t.size),duration:P,isPlaying:!1,url:e,file:t,actualDuration:m};k.value.push(O),w()})}),!1},b=qe({}),te=t=>{const e=k.value[t];b[t]||(b[t]=new Audio(e.url));const c=b[t];e.isPlaying?c.pause():(Object.entries(b).forEach(([w,m])=>{w!=t&&!m.paused&&(m.pause(),k.value[w].isPlaying=!1)}),c.play()),e.isPlaying=!e.isPlaying,c.addEventListener("ended",()=>{e.isPlaying=!1})},se=t=>{b[t]&&(b[t].pause(),b[t].src="",delete b[t]),k.value.splice(t,1)},he=(t,e)=>{const c=e.value.findIndex(w=>w.name===t.name);c!==-1&&se(c)},ae=i("second"),Se=()=>{D.incrementStep()},T=X(()=>{let t=0;for(const e of k.value){const c=parseInt(e.duration.slice(0,-1),10);t+=c}return t}),we=X(()=>({10:{style:{color:"#9ca3b3",fontSize:"17px"},label:"最小"},30:{style:{color:"#9ca3b3",fontSize:"17px"},label:"推荐"},90:{style:{color:"#9ca3b3",fontSize:"17px"},label:"最大"}})),Ie=i("填写声音名称"),Te=i("输入标签");function Ce(t){d.value.voiceName=t}function Ue(t){d.value.voiceDescription=t}function Me(t){d.value.voiceTag=t}const D=_t(),{step:K}=Qe(D),L=i(""),d=i({voiceType:"1",voiceImage:"",voiceName:"",voiceDescription:"",voiceTag:"",voiceLanguage:1}),xe=t=>{d.value.voiceImage=t.data.voiceImage},ze=async()=>{const t=new FormData;k.value.forEach(e=>{t.append("files",e.file)});try{let e=await et(t),c=await tt(d.value);v.value=e.data.sample,L.value=e.data.voiceId,console.log("音频上传成功:",v.value,L.value)}catch(e){console.error("音频上传失败:",e)}},De=async()=>{await ze(),k.value=[],Object.keys(b).forEach(t=>{b[t].pause(),b[t].src="",delete b[t]}),D.incrementStep()},Re=()=>{B.push("/mybank"),D.reduceStep()},$e=async()=>{B.push("/mybank"),D.reduceStep();const t=v.value.slice(1),e={voiceId:L.value,samples:t};await Je(e)},Ne=async()=>{B.push("/mybank"),D.reduceStep();const t=v.value.slice(1);await Ze(t)},Ve=async t=>{const e={voiceId:L.value,sampleText:v.value[t].sampleText};let c=await yt(e);v.value[t].sampleUrl=c.data.sampleUrl};de(async()=>{if(N!==void 0){let t=await Xe(N);d.value=t.data,v.value=t.data.voiceSamples}});const Ae=async()=>{({...d,voiceId:L.value},await Ye(d.value)),D.incrementStep()};return(t,e)=>{const c=u("el-radio-button"),w=u("el-radio-group"),m=u("el-icon"),P=u("el-upload"),O=u("el-tab-pane"),R=u("el-col"),oe=u("el-row"),Be=u("el-tabs"),Le=u("el-slider"),Pe=u("el-button"),Ee=u("el-divider");return o(),A(oe,null,{default:l(()=>[f(K)===1?(o(),A(R,{key:0,span:12},{default:l(()=>[e[20]||(e[20]=s("h2",null,"训练新声音",-1)),a(re,{currentStep:f(K)},null,8,["currentStep"]),s("div",null,[e[19]||(e[19]=s("h3",null,"声音详情",-1)),s("div",null,[s("div",gt,[e[3]||(e[3]=r(" 类型 ")),s("div",kt,[a(w,{modelValue:d.value.voiceType,"onUpdate:modelValue":e[0]||(e[0]=p=>d.value.voiceType=p),size:"large","text-color":"black",fill:"#fafafa"},{default:l(()=>[a(c,{label:"公开",value:"1"}),a(c,{label:"私有",value:"0"})]),_:1},8,["modelValue"])]),d.value.voiceType==="1"?(o(),n("div",bt," 此语音模型将在发现页面中可见，每个人都可以看到。 ")):(o(),n("div",ht,"此语音模型仅对创建者可见，不能共享且不会出现在发现页面。"))]),s("div",St,[e[5]||(e[5]=r(" 封面图 (可选) ")),s("div",wt,[s("div",It,[a(P,{class:"avatar-uploader","auto-upload":!0,"show-file-list":!1,action:"/api/common/upload",name:"file","on-success":xe},{default:l(()=>[d.value.voiceImage?(o(),n("img",{key:0,src:d.value.voiceImage,class:"avatar"},null,8,Tt)):(o(),A(m,{key:1,class:"avatar-uploader-icon"},{default:l(()=>[a(f(ne))]),_:1}))]),_:1})]),e[4]||(e[4]=s("h4",null,"声音封面图片 (文件最大不超过 2MB)",-1))])]),s("div",Ct,[e[6]||(e[6]=r(" 名称 ")),a(E,{message:d.value.voiceName,placeholder:Ie.value,class:"search-input",color:g.value,"onUpdate:message":Ce},null,8,["message","placeholder","color"])]),s("div",Ut,[e[7]||(e[7]=r(" 描述 (可选) ")),a(E,{message:d.value.voiceDescription,placeholder:_.value,color:g.value,type:y.value,"onUpdate:message":Ue},null,8,["message","placeholder","color","type"])]),s("div",Mt,[e[8]||(e[8]=r(" 标签 ")),a(E,{message:d.value.voiceTag,placeholder:Te.value,class:"search-input",color:g.value,"onUpdate:message":Me},null,8,["message","placeholder","color"])]),s("div",xt,[e[9]||(e[9]=r(" 语言 ")),a(Ke,{options:Q.value,"input-width":"655px",color:"#fafafa","onUpdate:value":G},null,8,["options"])])]),f(N)===void 0?(o(),n("div",zt,[e[18]||(e[18]=s("h3",null,"输入音频",-1)),a(Be,{modelValue:ae.value,"onUpdate:modelValue":e[1]||(e[1]=p=>ae.value=p),class:"demo-tabs"},{default:l(()=>[a(O,{label:"上传音频",name:"second"},{default:l(()=>[s("div",Dt,[a(P,{class:"upload-component",accept:"audio/*","before-upload":be,"show-file-list":!1,"file-list":k.value,"on-remove":he,limit:0},{default:l(()=>e[10]||(e[10]=[s("div",{class:"upload-button"},[s("div",{class:"insert"}),s("h5",null,"添加或删除您的音频文件")],-1)])),_:1},8,["file-list"])])]),_:1}),a(O,{label:"录制音频",name:"first"},{default:l(()=>[s("div",Rt,[j.value?(o(),n("div",{key:1,onClick:ge,class:"record"},e[12]||(e[12]=[s("div",{class:"noRecord"},null,-1),r(" 停止录制 ")]))):(o(),n("div",{key:0,onClick:fe,class:"record"},e[11]||(e[11]=[s("div",{class:"inRecord"},null,-1),r(" 点击开始录制 ")]))),e[13]||(e[13]=s("div",{style:{"font-size":"small",color:"#6b7280","margin-left":"20px"}}," *您可以使用自己的文本或下面的建议文本录制您的声音。",-1)),a(ft)])]),_:1}),s("div",$t,[(o(!0),n(q,null,W(k.value,(p,I)=>(o(),A(oe,{key:I,class:"files"},{default:l(()=>[a(R,{span:2,class:"logo"}),a(R,{span:13,class:"file"},{default:l(()=>[r(z(p.name)+" ",1),s("div",Nt,z(p.size),1)]),_:2},1024),a(R,{span:4},{default:l(()=>[r(z(p.duration),1)]),_:2},1024),a(R,{span:4,class:"btns"},{default:l(()=>[p.isPlaying?(o(),n("div",{key:1,class:"on",onClick:x=>te(I)},null,8,At)):(o(),n("div",{key:0,class:"close",onClick:x=>te(I)},null,8,Vt)),a(m,{onClick:x=>se(I),class:"delete-btn",size:"25"},{default:l(()=>[a(f(ie))]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))])]),_:1},8,["modelValue"]),s("div",Bt,[s("div",Lt,[r(" 已上传："+z(T.value)+"s ",1),T.value<=90&&T.value>=10?(o(),n("div",Pt,[a(m,{size:"20",color:"#16a149"},{default:l(()=>[a(f(Ge))]),_:1}),e[14]||(e[14]=r(" 不错 "))])):$("",!0),T.value>90?(o(),n("div",Et,[a(m,{size:"20",color:"#ef4343"},{default:l(()=>[a(f(ce))]),_:1}),e[15]||(e[15]=r(" 过长 "))])):$("",!0),T.value<10&&T.value>0?(o(),n("div",Ft,[a(m,{size:"20",color:"#ef4343"},{default:l(()=>[a(f(ce))]),_:1}),e[16]||(e[16]=r(" 过短 "))])):$("",!0),T.value===0?(o(),n("div",jt," 推荐 30 秒左右 ")):$("",!0)]),a(Le,{modelValue:T.value,"onUpdate:modelValue":e[2]||(e[2]=p=>T.value=p),min:"0",max:"100",step:1,"show-stops":"",marks:we.value,"show-tooltip":!1,"show-button":!1},null,8,["modelValue","marks"]),e[17]||(e[17]=s("div",{class:"tip"},"*提示：最短10秒，最长90秒，推荐30秒",-1))])])):$("",!0),f(N)===void 0?(o(),n("button",{key:1,class:"next-btn",onClick:De},"创建")):(o(),n("div",Ot,[s("button",{class:"next-btn",onClick:Ae},"保存"),s("button",{class:"skip",onClick:Se},"跳过")]))])]),_:1})):(o(),A(R,{key:1,span:12},{default:l(()=>[e[25]||(e[25]=s("h2",null,"训练新声音",-1)),a(re,{currentStep:f(K)},null,8,["currentStep"]),s("div",null,[e[24]||(e[24]=s("h3",null,"音频样本",-1)),s("div",qt,[(o(!0),n(q,null,W(v.value,(p,I)=>(o(),n("div",{key:p.sampleId,class:"audio-card"},[s("div",null,[s("div",Qt,[s("span",Gt,z(p.sampleTitle===""?"样本"+I:p.sampleTitle),1),a(m,{size:"20",color:"#606672",style:{cursor:"pointer"},onClick:x=>pe(I)},{default:l(()=>[a(f(ie))]),_:2},1032,["onClick"])])]),s("div",Ht,[a(E,{message:p.sampleTitle,placeholder:S.value,"onUpdate:message":x=>ve(I,x)},null,8,["message","placeholder","onUpdate:message"]),a(E,{message:p.sampleText,placeholder:C.value,type:y.value,rows:U.value,"onUpdate:message":x=>me(I,x)},null,8,["message","placeholder","type","rows","onUpdate:message"]),a(Pe,{color:"#e7e7e8",onClick:x=>Ve(I),style:{width:"16%","margin-left":"1%"}},{default:l(()=>e[21]||(e[21]=[s("div",{class:"make"},null,-1),r(" 生成样本 ")])),_:2},1032,["onClick"]),a(st,{audioUrl:p.sampleUrl},null,8,["audioUrl"])])]))),128)),s("div",Kt,[s("button",{onClick:F,class:"add-btn"},[a(m,{size:"20",style:{"padding-right":"5px"}},{default:l(()=>[a(f(ne))]),_:1}),e[22]||(e[22]=r()),e[23]||(e[23]=s("span",{style:{"font-size":"large"}},"添加音频示例",-1))])]),s("div",Wt,[f(N)===void 0?(o(),n("button",{key:0,class:"next-btn",onClick:$e},"保存")):(o(),n("button",{key:1,class:"next-btn",onClick:Ne},"保存")),s("button",{class:"skip",onClick:Re},"跳过")])])])]),_:1})),a(Ee,{direction:"vertical",style:{height:"auto"}}),a(R,{span:11,class:"reactivity"},{default:l(()=>[a(ut)]),_:1})]),_:1})}}},ls=Y(Xt,[["__scopeId","data-v-d8bb3790"]]);export{ls as default};
