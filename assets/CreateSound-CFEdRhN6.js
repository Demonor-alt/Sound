import{_ as Z,u as me,r as o,B as fe,b as c,C as i,o as l,f as t,E as $,e as s,K as Y,L as _e,c as F,a as n,D as M,g as d,h as k,F as qe,T as X,U as je,V as He,W as ie,n as ue,X as Oe,d as Qe,P as re,Y as Ke,Q as de,Z as ce,$ as Ge,a0 as ve}from"./index-Bl4hSf2D.js";import{t as We,M as Xe}from"./Select-CXED_CDb.js";import{c as Ye,e as Ze,f as Je,g as et,h as tt,i as at,j as st}from"./mybank-DtZM3VdH.js";import{M as K}from"./Input-WaUXDyCF.js";import{_ as lt,a as ot,b as nt,c as it}from"./speaker-DeKGlsBD.js";import{h as ut}from"./howler-YKEUKyjS.js";import{S as rt}from"./Store-DqdD8inb.js";import"./request-SCV2dptg.js";import"./token-YPBGfxfO.js";const dt={key:0},ct=["onClick"],vt={class:"tag"},pt={style:{display:"flex","flex-direction":"row",gap:"10px"}},mt={style:{"font-weight":"520",color:"#71717a"}},ft={__name:"Recent",setup(w){const m=me(),v=f=>{m.push({path:"/detail",query:{id:f}})},p=o([{voiceId:70,voiceImage:"https://loremflickr.com/400/400?lock=567532027855895",voiceName:"曲志明",voiceDescription:"例面求上。果圆相称斗织是。开电年。同利算术极七等被来。问广十世。",voiceCreationTime:"2024-04-22 00:28:31",voiceIsCollected:!0,voiceSamples:[{sampleId:83,sampleIsPlaying:!1,sampleTitle:"拨伟大快但是脊梁",sampleText:"consectetur",sampleUrl:"https://nutritious-designation.com/"}]}]);return fe(async()=>{let f=await Ye();p.value=f.data}),(f,b)=>{const T=c("el-empty"),r=c("el-image"),B=c("el-col"),A=c("el-tag"),q=c("el-icon"),P=c("el-row");return l(),i(Y,null,[b[2]||(b[2]=t("h2",null,"最近活动",-1)),p.value.length===0?(l(),i("div",dt,[s(T,{description:"暂无数据"})])):$("",!0),(l(!0),i(Y,null,_e(p.value,I=>(l(),F(P,{key:I.voiceId,class:"voice-item"},{default:n(()=>[s(B,{span:5,style:{display:"flex","align-items":"center","justify-content":"center"}},{default:n(()=>[s(r,{style:{width:"75px",height:"75px","border-radius":"10px"},src:I.voiceImage,fit:"cover"},null,8,["src"])]),_:2},1024),s(B,{span:19},{default:n(()=>[t("div",{style:{"font-size":"18px","font-weight":"800","padding-bottom":"10px",cursor:"pointer"},onClick:V=>v(I.voiceId)},M(I.voiceName),9,ct),t("div",vt,[s(A,{type:"success",round:"",effect:"dark",style:{width:"50px","font-weight":"1000"}},{default:n(()=>b[0]||(b[0]=[d("成功")])),_:1}),b[1]||(b[1]=t("div",{class:"dot"},null,-1)),t("div",pt,[s(q,{size:"20",style:{color:"#6b7280"}},{default:n(()=>[s(k(qe))]),_:1}),t("span",mt,M(k(We)(I.voiceCreationTime)),1)])])]),_:2},1024)]),_:2},1024))),128))],64)}}},_t=Z(ft,[["__scopeId","data-v-858a627e"]]),yt={class:"audio_right"},gt={class:"gap"},kt={class:"audio_time"},bt={class:"volume"},ht={class:"volume_progress"},St={__name:"StreamAudioPlayer",props:{buttonSize:{type:String,default:"30"},sliderLength:{type:String,default:"420"}},setup(w){const m=o(!1),v=o(null),p=o(0),f=o(.9),b=o(0),T=o("--"),r=o(!1),B=o(300);function A(y){if(y==="--")return"--";const g=Math.floor(y/60),C=Math.floor(y%60);return`${g}:${C<10?"0":""}${C}`}function q(){v.value&&v.value.seek(p.value/100*T.value)}function P(){v.value&&v.value.volume(f.value)}async function I(){if(m.value){v.value.pause(),m.value=!1,b.value=0,p.value=0;return}else m.value=!0;const y=new FormData;y.append("text","在信息爆炸的时代，我们每天被海量的数据包围，而阅读，这一古老的行为..."),y.append("text_lang","zh"),y.append("prompt_lang","zh"),y.append("streaming_mode","true"),y.append("ref_audio_path","D://雷军.mp3"),console.log("最终 FormData 内容:",Array.from(y.entries()));const g=new URLSearchParams;for(const[u,D]of y.entries())g.append(u,D);const C=`/api2/tts?${g.toString()}`;v.value=new ut.Howl({src:[C],xhr:{method:"GET"},html5:!0,volume:f.value,format:["wav"],onplay:()=>{V()},onload:()=>{v.value.duration()!==1/0&&(T.value=v.value.duration(),console.log("音频总时长:",T.value))},onend:()=>{m.value=!1,b.value=0,p.value=0},onloaderror:(u,D)=>{console.error("音频加载失败",D),D.value="音频加载失败",m.value=!1}}),v.value.play()}function V(){const y=setInterval(()=>{v.value&&m.value?(b.value=v.value.seek(),T.value!=="--"&&(p.value=b.value/T.value*100)):clearInterval(y)},500)}return(y,g)=>{const C=c("el-slider");return l(),i("div",yt,[t("div",gt,[m.value===!1?(l(),i("img",{key:0,onClick:I,class:"audio_icon",style:X({width:w.buttonSize+"px",height:w.buttonSize+"px"}),src:lt,alt:"播放"},null,4)):(l(),i("img",{key:1,onClick:I,class:"audio_icon",style:X({width:w.buttonSize+"px",height:w.buttonSize+"px"}),src:ot,alt:"暂停"},null,4)),t("div",kt,[t("span",null,M(A(b.value))+" / "+M(A(T.value)),1)]),s(C,{modelValue:p.value,"onUpdate:modelValue":g[0]||(g[0]=u=>p.value=u),"show-tooltip":!1,max:100,onInput:q,disabled:!m.value,class:"slider_box",style:X({width:B.value+"px"})},null,8,["modelValue","disabled","style"]),t("div",bt,[je(t("div",ht,[s(C,{"show-tooltip":!1,vertical:"",height:"100px",class:"volume_bar",max:1,modelValue:f.value,"onUpdate:modelValue":g[1]||(g[1]=u=>f.value=u),step:"0.01",onChange:P},null,8,["modelValue"])],512),[[He,r.value]]),f.value<=0?(l(),i("img",{key:0,class:"volume_icon",onClick:g[2]||(g[2]=ie(u=>r.value=!r.value,["stop"])),src:nt,alt:""})):$("",!0),f.value>0?(l(),i("img",{key:1,class:"volume_icon",onClick:g[3]||(g[3]=ie(u=>r.value=!r.value,["stop"])),src:it,alt:""})):$("",!0)])])])}}},wt=Z(St,[["__scopeId","data-v-6e4e4868"]]),xt={class:"steps"},pe={__name:"Step",props:{currentStep:Number},setup(w){const m=w;return(v,p)=>{const f=c("el-divider");return l(),i("div",xt,[t("div",{class:ue(["step",{active:m.currentStep===1}])},"1",2),p[0]||(p[0]=t("div",{class:"detail"},[t("div",{class:"title"},"步骤1"),d(" 声音详情 ")],-1)),s(f,{class:"thick-divider"}),t("div",{class:ue(["step",{active:m.currentStep===2}])},"2",2),p[1]||(p[1]=t("div",{class:"detail"},[t("div",{class:"title"},"步骤2"),d(" 示例音频 ")],-1))])}}},It=Oe("step",()=>{const w=o(1);function m(){w.value=2}function v(){w.value=1}return{step:w,incrementStep:m,reduceStep:v}}),Tt={class:"form-section"},zt={class:"radio"},Ct={key:0,style:{"font-size":"small",color:"#6b748b"}},Dt={key:1,style:{"font-size":"small",color:"#6b748b"}},Ut={class:"form-section"},$t={class:"avatar"},Mt={class:"upload-box"},Vt=["src"],Pt={class:"form-section"},Rt={class:"form-section"},Nt={class:"form-section"},Lt={class:"form-section"},Bt={key:0},At={class:"audio-upload"},Et={class:"audio-player"},Ft={class:"audio-upload"},qt={class:"size"},jt={class:"time-picker"},Ht={class:"loadHeader"},Ot={key:0,class:"icon"},Qt={key:1,class:"icon"},Kt={key:2,class:"icon"},Gt={key:3,class:"icon"},Wt={key:2,class:"btnssecond"},Xt={class:"audio-container"},Yt={class:"card-header"},Zt={style:{"font-weight":"600"}},Jt={class:"myinput"},ea={class:"add-button-container"},ta={class:"btnssecond"},aa={__name:"CreateSound",setup(w){const m=o("输入音频样本标题"),v=o("输入音频样本文本"),p=o("textarea"),f=o("#fafafa"),b=o("填写音频描述"),T=o("3"),r=o([{sampleId:"",sampleTitle:"",sampleText:"",sampleUrl:"",sampleIsPlaying:!1}]),B=()=>{r.value.push({sampleTitle:"",sampleText:"",sampleUrl:"",sampleIsPlaying:!1})},A=o([{value:"1",label:"中文"},{value:"2",label:"English"}]),q=a=>{_.value.voiceLanguage=parseInt(a,10)},P=me(),I=Qe(),V=I.query?I.query.id:void 0,y=a=>{const e=r.value[a];e.audio&&(e.audio.pause(),e.audio.currentTime=0),r.value.splice(a,1)};function g(a,e){r.value[a].sampleTitle=e}function C(a,e){r.value[a].sampleText=e}const u=o(),D=o(!1),E=o(null),G=o([]),J=o(),ee=o(),ye=async()=>{J.value=new Date;try{const a=await navigator.mediaDevices.getUserMedia({audio:!0});E.value=new MediaRecorder(a),G.value=[],E.value.ondataavailable=e=>{e.data.size>0&&G.value.push(e.data)},E.value.start(),D.value=!0,E.value.onstop=()=>{const e=new Blob(G.value,{type:"audio/mp3"});e.value=e,D.value=!1,a.getTracks().forEach(h=>h.stop()),ke(e)}}catch(a){console.error("获取音频流失败：",a)}};function ge(a,e){const h=new Date(a),N=new Date(e),x=Math.abs(N.getTime()-h.getTime());return Math.floor(x/1e3)}const ke=async a=>{ee.value=new Date;const e=new FormData,h=new File([a],"record.mp3",{type:"audio/mp3"});e.append("files",h);try{u.value={name:"record.mp3",url:URL.createObjectURL(a),blob:a,duration:`${ge(J.value,ee.value)}s`,size:te(a.size),file:h}}catch(N){console.error("上传失败:",N)}},be=()=>{E.value&&(E.value.stop(),D.value=!1)},te=a=>`${(a/1024).toFixed(2)} KB`,he=a=>isNaN(a)||a===1/0?"未知":`${Math.floor(a)}s`,Se=async a=>{const e=URL.createObjectURL(a),h=new Audio(e);await new Promise(N=>{h.addEventListener("loadedmetadata",()=>{const x=h.duration,H=he(x);u.value={name:a.name,size:te(a.size),duration:H,isPlaying:!1,url:e,file:a,actualDuration:x},N()})})},z=o(null),ae=()=>{z.value&&(z.value.pause(),z.value.removeEventListener("ended",a)),z.value=new Audio(u.value.url);const a=()=>{u.value.isPlaying=!1};z.value.addEventListener("ended",a),u.value.isPlaying?z.value.pause():z.value.play(),u.value.isPlaying=!u.value.isPlaying},se=()=>{z.value&&(z.value.pause(),z.value.src=""),u.value=void 0},le=o("second"),we=()=>{R.incrementStep()},U=re(()=>u.value===void 0?0:parseInt(u.value.duration.slice(0,-1),10)),xe=re(()=>({10:{style:{color:"#9ca3b3",fontSize:"17px"},label:"最小"},30:{style:{color:"#9ca3b3",fontSize:"17px"},label:"推荐"},90:{style:{color:"#9ca3b3",fontSize:"17px"},label:"最大"}})),Ie=o("填写声音名称"),Te=o("输入标签");function ze(a){_.value.voiceName=a}function Ce(a){_.value.voiceDescription=a}function De(a){_.value.voiceTag=a}const R=It(),{step:W}=Ke(R),j=o(""),_=o({voiceType:"1",voiceImage:"",voiceName:"",voiceDescription:"",voiceTag:"",voiceLanguage:1}),Ue=a=>{_.value.voiceImage=a.data.voiceImage},$e=async()=>{const a=new FormData;a.append("text","1111"),a.append("text_lang","zh"),a.append("prompt_lang","zh"),a.append("ref_audio",u.value);try{let e=await at(a);console.log(e);let h=await st(_.value);j.value=h.data.voiceId,r.value=e.data.sample,console.log("音频上传成功:",r.value,j.value)}catch(e){console.error("音频上传失败:",e)}},Me=async()=>{await $e(),R.incrementStep()},Ve=()=>{P.push("/mybank"),R.reduceStep()},Pe=async()=>{P.push("/mybank"),R.reduceStep();const a={voiceId:j.value,samples:r.value};await et(a)},Re=async()=>{P.push("/mybank"),R.reduceStep();const a=r.value.slice(1);await tt(a)},Ne=async a=>{j.value,r.value[a].sampleText};fe(async()=>{if(V!==void 0){let a=await Ze(V);_.value=a.data,r.value=a.data.voiceSamples}});const Le=async()=>{({..._,voiceId:j.value},await Je(_.value)),R.incrementStep()};return(a,e)=>{const h=c("el-radio-button"),N=c("el-radio-group"),x=c("el-icon"),H=c("el-upload"),oe=c("el-tab-pane"),L=c("el-col"),ne=c("el-row"),Be=c("el-tabs"),Ae=c("el-slider"),Ee=c("el-button"),Fe=c("el-divider");return l(),F(ne,null,{default:n(()=>[k(W)===1?(l(),F(L,{key:0,span:12},{default:n(()=>[e[23]||(e[23]=t("h2",null,"训练新声音",-1)),s(pe,{currentStep:k(W)},null,8,["currentStep"]),t("div",null,[e[22]||(e[22]=t("h3",null,"声音详情",-1)),t("div",null,[t("div",Tt,[e[6]||(e[6]=d(" 类型 ")),t("div",zt,[s(N,{modelValue:_.value.voiceType,"onUpdate:modelValue":e[0]||(e[0]=S=>_.value.voiceType=S),size:"large","text-color":"black",fill:"#fafafa"},{default:n(()=>[s(h,{label:"公开",value:"1"}),s(h,{label:"私有",value:"0"})]),_:1},8,["modelValue"])]),_.value.voiceType==="1"?(l(),i("div",Ct," 此语音模型将在发现页面中可见，每个人都可以看到。 ")):(l(),i("div",Dt,"此语音模型仅对创建者可见，不能共享且不会出现在发现页面。"))]),t("div",Ut,[e[8]||(e[8]=d(" 封面图 (可选) ")),t("div",$t,[t("div",Mt,[s(H,{class:"avatar-uploader","auto-upload":!0,"show-file-list":!1,action:"/api1/common/upload",name:"file","on-success":Ue},{default:n(()=>[_.value.voiceImage?(l(),i("img",{key:0,src:_.value.voiceImage,class:"avatar"},null,8,Vt)):(l(),F(x,{key:1,class:"avatar-uploader-icon"},{default:n(()=>[s(k(de))]),_:1}))]),_:1})]),e[7]||(e[7]=t("h4",null,"声音封面图片 (文件最大不超过 2MB)",-1))])]),t("div",Pt,[e[9]||(e[9]=d(" 名称 ")),s(K,{message:_.value.voiceName,placeholder:Ie.value,class:"search-input",color:f.value,"onUpdate:message":ze},null,8,["message","placeholder","color"])]),t("div",Rt,[e[10]||(e[10]=d(" 描述 (可选) ")),s(K,{message:_.value.voiceDescription,placeholder:b.value,color:f.value,type:p.value,"onUpdate:message":Ce},null,8,["message","placeholder","color","type"])]),t("div",Nt,[e[11]||(e[11]=d(" 标签 ")),s(K,{message:_.value.voiceTag,placeholder:Te.value,class:"search-input",color:f.value,"onUpdate:message":De},null,8,["message","placeholder","color"])]),t("div",Lt,[e[12]||(e[12]=d(" 语言 ")),s(Xe,{options:A.value,"input-width":"655px",color:"#fafafa","onUpdate:value":q},null,8,["options"])])]),k(V)===void 0?(l(),i("div",Bt,[e[21]||(e[21]=t("h3",null,"输入音频",-1)),s(Be,{modelValue:le.value,"onUpdate:modelValue":e[4]||(e[4]=S=>le.value=S),class:"demo-tabs"},{default:n(()=>[s(oe,{label:"上传音频",name:"second"},{default:n(()=>[t("div",At,[s(H,{class:"upload-component",accept:"audio/*","before-upload":Se,"show-file-list":!1,"on-remove":se,limit:1},{default:n(()=>e[13]||(e[13]=[t("div",{class:"upload-button"},[t("div",{class:"insert"}),t("h5",null,"添加您的音频文件")],-1)])),_:1})])]),_:1}),s(oe,{label:"录制音频",name:"first"},{default:n(()=>[t("div",Et,[D.value?(l(),i("div",{key:1,onClick:be,class:"record"},e[15]||(e[15]=[t("div",{class:"noRecord"},null,-1),d(" 停止录制 ")]))):(l(),i("div",{key:0,onClick:ye,class:"record"},e[14]||(e[14]=[t("div",{class:"inRecord"},null,-1),d(" 点击开始录制 ")]))),e[16]||(e[16]=t("div",{style:{"font-size":"small",color:"#6b7280","margin-left":"20px"}}," *您可以使用自己的文本或下面的建议文本录制您的声音。",-1)),s(rt)])]),_:1}),t("div",Ft,[u.value!==void 0?(l(),F(ne,{key:a.index,class:"files"},{default:n(()=>[s(L,{span:2,class:"logo"}),s(L,{span:13,class:"file"},{default:n(()=>[d(M(u.value.name)+" ",1),t("div",qt,M(u.value.size),1)]),_:1}),s(L,{span:4},{default:n(()=>[d(M(u.value.duration),1)]),_:1}),s(L,{span:4,class:"btns"},{default:n(()=>[u.value.isPlaying?(l(),i("div",{key:1,class:"on",onClick:e[2]||(e[2]=S=>ae())})):(l(),i("div",{key:0,class:"close",onClick:e[1]||(e[1]=S=>ae())})),s(x,{onClick:e[3]||(e[3]=S=>se()),class:"delete-btn",size:"25"},{default:n(()=>[s(k(ce))]),_:1})]),_:1})]),_:1})):$("",!0)])]),_:1},8,["modelValue"]),t("div",jt,[t("div",Ht,[d(" 已上传："+M(U.value)+"s ",1),U.value<=90&&U.value>=10?(l(),i("div",Ot,[s(x,{size:"20",color:"#16a149"},{default:n(()=>[s(k(Ge))]),_:1}),e[17]||(e[17]=d(" 不错 "))])):$("",!0),U.value>90?(l(),i("div",Qt,[s(x,{size:"20",color:"#ef4343"},{default:n(()=>[s(k(ve))]),_:1}),e[18]||(e[18]=d(" 过长 "))])):$("",!0),U.value<10&&U.value>0?(l(),i("div",Kt,[s(x,{size:"20",color:"#ef4343"},{default:n(()=>[s(k(ve))]),_:1}),e[19]||(e[19]=d(" 过短 "))])):$("",!0),U.value===0?(l(),i("div",Gt," 推荐 30 秒左右 ")):$("",!0)]),s(Ae,{modelValue:U.value,"onUpdate:modelValue":e[5]||(e[5]=S=>U.value=S),min:"0",max:"100",step:1,"show-stops":"",marks:xe.value,"show-tooltip":!1,"show-button":!1},null,8,["modelValue","marks"]),e[20]||(e[20]=t("div",{class:"tip"},"*提示：最短10秒，最长90秒，推荐30秒",-1))])])):$("",!0),k(V)===void 0?(l(),i("button",{key:1,class:"next-btn",onClick:Me},"创建")):(l(),i("div",Wt,[t("button",{class:"next-btn",onClick:Le},"保存"),t("button",{class:"skip",onClick:we},"跳过")]))])]),_:1})):(l(),F(L,{key:1,span:12},{default:n(()=>[e[28]||(e[28]=t("h2",null,"训练新声音",-1)),s(pe,{currentStep:k(W)},null,8,["currentStep"]),t("div",null,[e[27]||(e[27]=t("h3",null,"音频样本",-1)),t("div",Xt,[(l(!0),i(Y,null,_e(r.value,(S,O)=>(l(),i("div",{key:S.sampleId,class:"audio-card"},[t("div",null,[t("div",Yt,[t("span",Zt,M(S.sampleTitle===""?"样本"+O:S.sampleTitle),1),s(x,{size:"20",color:"#606672",style:{cursor:"pointer"},onClick:Q=>y(O)},{default:n(()=>[s(k(ce))]),_:2},1032,["onClick"])])]),t("div",Jt,[s(K,{message:S.sampleTitle,placeholder:m.value,"onUpdate:message":Q=>g(O,Q)},null,8,["message","placeholder","onUpdate:message"]),s(K,{message:S.sampleText,placeholder:v.value,type:p.value,rows:T.value,"onUpdate:message":Q=>C(O,Q)},null,8,["message","placeholder","type","rows","onUpdate:message"]),s(Ee,{color:"#e7e7e8",onClick:Q=>Ne(O),style:{width:"16%","margin-left":"1%"}},{default:n(()=>e[24]||(e[24]=[t("div",{class:"make"},null,-1),d(" 生成样本 ")])),_:2},1032,["onClick"]),s(wt)])]))),128)),t("div",ea,[t("button",{onClick:B,class:"add-btn"},[s(x,{size:"20",style:{"padding-right":"5px"}},{default:n(()=>[s(k(de))]),_:1}),e[25]||(e[25]=d()),e[26]||(e[26]=t("span",{style:{"font-size":"large"}},"添加音频示例",-1))])]),t("div",ta,[k(V)===void 0?(l(),i("button",{key:0,class:"next-btn",onClick:Pe},"保存")):(l(),i("button",{key:1,class:"next-btn",onClick:Re},"保存")),t("button",{class:"skip",onClick:Ve},"跳过")])])])]),_:1})),s(Fe,{direction:"vertical",style:{height:"auto"}}),s(L,{span:11,class:"reactivity"},{default:n(()=>[s(_t)]),_:1})]),_:1})}}},va=Z(aa,[["__scopeId","data-v-7c8ac6de"]]);export{va as default};
