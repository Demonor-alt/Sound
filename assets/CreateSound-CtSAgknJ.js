import{_ as re,u as de,r as c,B as ue,b as d,C as i,o,f as s,E as R,e as a,K as j,L as G,c as $,a as n,D as x,g as r,h as m,F as Fe,n as ae,d as je,z as Oe,P as oe,T as qe,Q as le,U as ne,V as Qe,W as ie}from"./index-xB3zmTvq.js";import{t as Ke,M as He}from"./Select-CN6uJggY.js";import{c as We,e as Ge,f as Je,g as Xe,h as Ye,i as Ze,j as et}from"./mybank-Knf6EMoV.js";import{M as B}from"./Input-Dw3SY6Rn.js";import{A as tt}from"./AudioPlayer-COFS9Gy2.js";import{u as st,S as at}from"./step-ChmADsNK.js";import"./request-ehLWX7Tg.js";import"./token-C_J44ZhT.js";/* empty css                                                    */const ot={key:0},lt=["onClick"],nt={class:"tag"},it={style:{display:"flex","flex-direction":"row",gap:"10px"}},ct={style:{"font-weight":"520",color:"#71717a"}},rt={__name:"Recent",setup(O){const z=de(),L=b=>{z.push({path:"/detail",query:{id:b}})},k=c([{voiceId:70,voiceImage:"https://loremflickr.com/400/400?lock=567532027855895",voiceName:"曲志明",voiceDescription:"例面求上。果圆相称斗织是。开电年。同利算术极七等被来。问广十世。",voiceCreationTime:"2024-04-22 00:28:31",voiceIsCollected:!0,voiceSamples:[{sampleId:83,sampleIsPlaying:!1,sampleTitle:"拨伟大快但是脊梁",sampleText:"consectetur",sampleUrl:"https://nutritious-designation.com/"}]}]);return ue(async()=>{let b=await We();k.value=b.data}),(b,w)=>{const q=d("el-empty"),f=d("el-image"),A=d("el-col"),Q=d("el-tag"),K=d("el-icon"),N=d("el-row");return o(),i(j,null,[w[2]||(w[2]=s("h2",null,"最近活动",-1)),k.value.length===0?(o(),i("div",ot,[a(q,{description:"暂无数据"})])):R("",!0),(o(!0),i(j,null,G(k.value,I=>(o(),$(N,{key:I.voiceId,class:"voice-item"},{default:n(()=>[a(A,{span:5,style:{display:"flex","align-items":"center","justify-content":"center"}},{default:n(()=>[a(f,{style:{width:"75px",height:"75px","border-radius":"10px"},src:I.voiceImage,fit:"cover"},null,8,["src"])]),_:2},1024),a(A,{span:19},{default:n(()=>[s("div",{style:{"font-size":"18px","font-weight":"800","padding-bottom":"10px",cursor:"pointer"},onClick:D=>L(I.voiceId)},x(I.voiceName),9,lt),s("div",nt,[a(Q,{type:"success",round:"",effect:"dark",style:{width:"50px","font-weight":"1000"}},{default:n(()=>w[0]||(w[0]=[r("成功")])),_:1}),w[1]||(w[1]=s("div",{class:"dot"},null,-1)),s("div",it,[a(K,{size:"20",style:{color:"#6b7280"}},{default:n(()=>[a(m(Fe))]),_:1}),s("span",ct,x(m(Ke)(I.voiceCreationTime)),1)])])]),_:2},1024)]),_:2},1024))),128))],64)}}},dt=re(rt,[["__scopeId","data-v-858a627e"]]),ut={class:"steps"},ce={__name:"Step",props:{currentStep:Number},setup(O){const z=O;return(L,k)=>{const b=d("el-divider");return o(),i("div",ut,[s("div",{class:ae(["step",{active:z.currentStep===1}])},"1",2),k[0]||(k[0]=s("div",{class:"detail"},[s("div",{class:"title"},"步骤1"),r(" 声音详情 ")],-1)),a(b,{class:"thick-divider"}),s("div",{class:ae(["step",{active:z.currentStep===2}])},"2",2),k[1]||(k[1]=s("div",{class:"detail"},[s("div",{class:"title"},"步骤2"),r(" 示例音频 ")],-1))])}}},pt={class:"form-section"},vt={class:"radio"},mt={key:0,style:{"font-size":"small",color:"#6b748b"}},ft={key:1,style:{"font-size":"small",color:"#6b748b"}},_t={class:"form-section"},gt={class:"avatar"},yt={class:"upload-box"},kt=["src"],bt={class:"form-section"},ht={class:"form-section"},St={class:"form-section"},wt={class:"form-section"},It={key:0},Tt={class:"audio-upload"},Ct={class:"audio-player"},Ut={class:"audio-upload"},xt={class:"size"},zt=["onClick"],Dt=["onClick"],Mt={class:"time-picker"},Rt={class:"loadHeader"},$t={key:0,class:"icon"},Nt={key:1,class:"icon"},Vt={key:2,class:"icon"},Pt={key:3,class:"icon"},Bt={key:2,class:"btnssecond"},Lt={class:"audio-container"},At={class:"card-header"},Et={style:{"font-weight":"600"}},Ft={class:"myinput"},jt={class:"add-button-container"},Ot={class:"btnssecond"},qt={__name:"CreateSound",setup(O){const z=c("输入音频样本标题"),L=c("输入音频样本文本"),k=c("textarea"),b=c("#fafafa"),w=c("填写音频描述"),q=c("3"),f=c([{sampleId:"",sampleTitle:"",sampleText:"",sampleUrl:"",sampleIsPlaying:!1}]),A=()=>{f.value.push({sampleTitle:"",sampleText:"",sampleUrl:"",sampleIsPlaying:!1})},Q=c([{value:"1",label:"中文"},{value:"2",label:"English"}]),K=t=>{u.value.voiceLanguage=parseInt(t,10)},N=de(),I=je(),D=I.query?I.query.id:void 0,pe=t=>{const e=f.value[t];e.audio&&(e.audio.pause(),e.audio.currentTime=0),f.value.splice(t,1)};function ve(t,e){f.value[t].sampleTitle=e}function me(t,e){f.value[t].sampleText=e}const _=c([]),E=c(!1),M=c(null),H=c([]),J=c(),X=c(),fe=async()=>{J.value=new Date;try{const t=await navigator.mediaDevices.getUserMedia({audio:!0});M.value=new MediaRecorder(t),H.value=[],M.value.ondataavailable=e=>{e.data.size>0&&H.value.push(e.data)},M.value.start(),E.value=!0,M.value.onstop=()=>{const e=new Blob(H.value,{type:"audio/mp3"});e.value=e,E.value=!1,t.getTracks().forEach(l=>l.stop()),ge(e)}}catch(t){console.error("获取音频流失败：",t)}};function _e(t,e){const l=new Date(t),y=new Date(e),v=Math.abs(y.getTime()-l.getTime());return Math.floor(v/1e3)}const ge=async t=>{X.value=new Date;const e={name:`record-${_.value.length+1}.mp3`,url:URL.createObjectURL(t),blob:t,duration:`${_e(J.value,X.value)}s`,size:Y(t.size),file:new File([t],`record-${_.value.length+1}.mp3`,{type:"audio/mp3"})};_.value.unshift(e)},ye=()=>{M.value&&(M.value.stop(),E.value=!1)},Y=t=>`${(t/1024).toFixed(2)} KB`,ke=t=>isNaN(t)||t===1/0?"未知":`${Math.floor(t)}s`,be=async t=>{const e=URL.createObjectURL(t),l=new Audio(URL.createObjectURL(t));return await new Promise(y=>{l.addEventListener("loadedmetadata",()=>{const v=l.duration,P=ke(v),F={name:t.name,size:Y(t.size),duration:P,isPlaying:!1,url:e,file:t,actualDuration:v};_.value.push(F),y()})}),!1},g=Oe({}),Z=t=>{const e=_.value[t];g[t]||(g[t]=new Audio(e.url));const l=g[t];e.isPlaying?l.pause():(Object.entries(g).forEach(([y,v])=>{y!=t&&!v.paused&&(v.pause(),_.value[y].isPlaying=!1)}),l.play()),e.isPlaying=!e.isPlaying,l.addEventListener("ended",()=>{e.isPlaying=!1})},ee=t=>{g[t]&&(g[t].pause(),g[t].src="",delete g[t]),_.value.splice(t,1)},he=(t,e)=>{const l=e.value.findIndex(y=>y.name===t.name);l!==-1&&ee(l)},te=c("second"),Se=()=>{C.incrementStep()},S=oe(()=>{let t=0;for(const e of _.value){const l=parseInt(e.duration.slice(0,-1),10);t+=l}return t}),we=oe(()=>({10:{style:{color:"#9ca3b3",fontSize:"17px"},label:"最小"},30:{style:{color:"#9ca3b3",fontSize:"17px"},label:"推荐"},90:{style:{color:"#9ca3b3",fontSize:"17px"},label:"最大"}})),Ie=c("填写声音名称"),Te=c("输入标签");function Ce(t){u.value.voiceName=t}function Ue(t){u.value.voiceDescription=t}function xe(t){u.value.voiceTag=t}const C=st(),{step:W}=qe(C),V=c(""),u=c({voiceType:"1",voiceImage:"",voiceName:"",voiceDescription:"",voiceTag:"",voiceLanguage:1}),ze=t=>{u.value.voiceImage=t.data.voiceImage},De=async()=>{const t=new FormData;_.value.forEach(l=>{console.log(l),t.append("audio_file",l)}),console.log(t);const e=new FormData;e.append("text","1111"),e.append("text_lang","zh"),e.append("prompt_lang","zh"),_.value.forEach(l=>{e.append("ref_audio",loadResult)});try{let l=await Ze(e);console.log(l);let y=await et(u.value);V.value=y.data.voiceId,f.value=l.data.sample,console.log("音频上传成功:",f.value,V.value)}catch(l){console.error("音频上传失败:",l)}},Me=async()=>{await De(),Object.keys(g).forEach(t=>{g[t].pause(),g[t].src="",delete g[t]}),C.incrementStep()},Re=()=>{N.push("/mybank"),C.reduceStep()},$e=async()=>{N.push("/mybank"),C.reduceStep();const t={voiceId:V.value,samples:f.value};await Xe(t)},Ne=async()=>{N.push("/mybank"),C.reduceStep();const t=f.value.slice(1);await Ye(t)},Ve=async t=>{V.value,f.value[t].sampleText};ue(async()=>{if(D!==void 0){let t=await Ge(D);u.value=t.data,f.value=t.data.voiceSamples}});const Pe=async()=>{({...u,voiceId:V.value},await Je(u.value)),C.incrementStep()};return(t,e)=>{const l=d("el-radio-button"),y=d("el-radio-group"),v=d("el-icon"),P=d("el-upload"),F=d("el-tab-pane"),U=d("el-col"),se=d("el-row"),Be=d("el-tabs"),Le=d("el-slider"),Ae=d("el-button"),Ee=d("el-divider");return o(),$(se,null,{default:n(()=>[m(W)===1?(o(),$(U,{key:0,span:12},{default:n(()=>[e[20]||(e[20]=s("h2",null,"训练新声音",-1)),a(ce,{currentStep:m(W)},null,8,["currentStep"]),s("div",null,[e[19]||(e[19]=s("h3",null,"声音详情",-1)),s("div",null,[s("div",pt,[e[3]||(e[3]=r(" 类型 ")),s("div",vt,[a(y,{modelValue:u.value.voiceType,"onUpdate:modelValue":e[0]||(e[0]=p=>u.value.voiceType=p),size:"large","text-color":"black",fill:"#fafafa"},{default:n(()=>[a(l,{label:"公开",value:"1"}),a(l,{label:"私有",value:"0"})]),_:1},8,["modelValue"])]),u.value.voiceType==="1"?(o(),i("div",mt," 此语音模型将在发现页面中可见，每个人都可以看到。 ")):(o(),i("div",ft,"此语音模型仅对创建者可见，不能共享且不会出现在发现页面。"))]),s("div",_t,[e[5]||(e[5]=r(" 封面图 (可选) ")),s("div",gt,[s("div",yt,[a(P,{class:"avatar-uploader","auto-upload":!0,"show-file-list":!1,action:"/api/common/upload",name:"file","on-success":ze},{default:n(()=>[u.value.voiceImage?(o(),i("img",{key:0,src:u.value.voiceImage,class:"avatar"},null,8,kt)):(o(),$(v,{key:1,class:"avatar-uploader-icon"},{default:n(()=>[a(m(le))]),_:1}))]),_:1})]),e[4]||(e[4]=s("h4",null,"声音封面图片 (文件最大不超过 2MB)",-1))])]),s("div",bt,[e[6]||(e[6]=r(" 名称 ")),a(B,{message:u.value.voiceName,placeholder:Ie.value,class:"search-input",color:b.value,"onUpdate:message":Ce},null,8,["message","placeholder","color"])]),s("div",ht,[e[7]||(e[7]=r(" 描述 (可选) ")),a(B,{message:u.value.voiceDescription,placeholder:w.value,color:b.value,type:k.value,"onUpdate:message":Ue},null,8,["message","placeholder","color","type"])]),s("div",St,[e[8]||(e[8]=r(" 标签 ")),a(B,{message:u.value.voiceTag,placeholder:Te.value,class:"search-input",color:b.value,"onUpdate:message":xe},null,8,["message","placeholder","color"])]),s("div",wt,[e[9]||(e[9]=r(" 语言 ")),a(He,{options:Q.value,"input-width":"655px",color:"#fafafa","onUpdate:value":K},null,8,["options"])])]),m(D)===void 0?(o(),i("div",It,[e[18]||(e[18]=s("h3",null,"输入音频",-1)),a(Be,{modelValue:te.value,"onUpdate:modelValue":e[1]||(e[1]=p=>te.value=p),class:"demo-tabs"},{default:n(()=>[a(F,{label:"上传音频",name:"second"},{default:n(()=>[s("div",Tt,[a(P,{class:"upload-component",accept:"audio/*","before-upload":be,"show-file-list":!1,"file-list":_.value,"on-remove":he,limit:0},{default:n(()=>e[10]||(e[10]=[s("div",{class:"upload-button"},[s("div",{class:"insert"}),s("h5",null,"添加或删除您的音频文件")],-1)])),_:1},8,["file-list"])])]),_:1}),a(F,{label:"录制音频",name:"first"},{default:n(()=>[s("div",Ct,[E.value?(o(),i("div",{key:1,onClick:ye,class:"record"},e[12]||(e[12]=[s("div",{class:"noRecord"},null,-1),r(" 停止录制 ")]))):(o(),i("div",{key:0,onClick:fe,class:"record"},e[11]||(e[11]=[s("div",{class:"inRecord"},null,-1),r(" 点击开始录制 ")]))),e[13]||(e[13]=s("div",{style:{"font-size":"small",color:"#6b7280","margin-left":"20px"}}," *您可以使用自己的文本或下面的建议文本录制您的声音。",-1)),a(at)])]),_:1}),s("div",Ut,[(o(!0),i(j,null,G(_.value,(p,h)=>(o(),$(se,{key:h,class:"files"},{default:n(()=>[a(U,{span:2,class:"logo"}),a(U,{span:13,class:"file"},{default:n(()=>[r(x(p.name)+" ",1),s("div",xt,x(p.size),1)]),_:2},1024),a(U,{span:4},{default:n(()=>[r(x(p.duration),1)]),_:2},1024),a(U,{span:4,class:"btns"},{default:n(()=>[p.isPlaying?(o(),i("div",{key:1,class:"on",onClick:T=>Z(h)},null,8,Dt)):(o(),i("div",{key:0,class:"close",onClick:T=>Z(h)},null,8,zt)),a(v,{onClick:T=>ee(h),class:"delete-btn",size:"25"},{default:n(()=>[a(m(ne))]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))])]),_:1},8,["modelValue"]),s("div",Mt,[s("div",Rt,[r(" 已上传："+x(S.value)+"s ",1),S.value<=90&&S.value>=10?(o(),i("div",$t,[a(v,{size:"20",color:"#16a149"},{default:n(()=>[a(m(Qe))]),_:1}),e[14]||(e[14]=r(" 不错 "))])):R("",!0),S.value>90?(o(),i("div",Nt,[a(v,{size:"20",color:"#ef4343"},{default:n(()=>[a(m(ie))]),_:1}),e[15]||(e[15]=r(" 过长 "))])):R("",!0),S.value<10&&S.value>0?(o(),i("div",Vt,[a(v,{size:"20",color:"#ef4343"},{default:n(()=>[a(m(ie))]),_:1}),e[16]||(e[16]=r(" 过短 "))])):R("",!0),S.value===0?(o(),i("div",Pt," 推荐 30 秒左右 ")):R("",!0)]),a(Le,{modelValue:S.value,"onUpdate:modelValue":e[2]||(e[2]=p=>S.value=p),min:"0",max:"100",step:1,"show-stops":"",marks:we.value,"show-tooltip":!1,"show-button":!1},null,8,["modelValue","marks"]),e[17]||(e[17]=s("div",{class:"tip"},"*提示：最短10秒，最长90秒，推荐30秒",-1))])])):R("",!0),m(D)===void 0?(o(),i("button",{key:1,class:"next-btn",onClick:Me},"创建")):(o(),i("div",Bt,[s("button",{class:"next-btn",onClick:Pe},"保存"),s("button",{class:"skip",onClick:Se},"跳过")]))])]),_:1})):(o(),$(U,{key:1,span:12},{default:n(()=>[e[25]||(e[25]=s("h2",null,"训练新声音",-1)),a(ce,{currentStep:m(W)},null,8,["currentStep"]),s("div",null,[e[24]||(e[24]=s("h3",null,"音频样本",-1)),s("div",Lt,[(o(!0),i(j,null,G(f.value,(p,h)=>(o(),i("div",{key:p.sampleId,class:"audio-card"},[s("div",null,[s("div",At,[s("span",Et,x(p.sampleTitle===""?"样本"+h:p.sampleTitle),1),a(v,{size:"20",color:"#606672",style:{cursor:"pointer"},onClick:T=>pe(h)},{default:n(()=>[a(m(ne))]),_:2},1032,["onClick"])])]),s("div",Ft,[a(B,{message:p.sampleTitle,placeholder:z.value,"onUpdate:message":T=>ve(h,T)},null,8,["message","placeholder","onUpdate:message"]),a(B,{message:p.sampleText,placeholder:L.value,type:k.value,rows:q.value,"onUpdate:message":T=>me(h,T)},null,8,["message","placeholder","type","rows","onUpdate:message"]),a(Ae,{color:"#e7e7e8",onClick:T=>Ve(h),style:{width:"16%","margin-left":"1%"}},{default:n(()=>e[21]||(e[21]=[s("div",{class:"make"},null,-1),r(" 生成样本 ")])),_:2},1032,["onClick"]),a(tt,{audioUrl:p.sampleUrl},null,8,["audioUrl"])])]))),128)),s("div",jt,[s("button",{onClick:A,class:"add-btn"},[a(v,{size:"20",style:{"padding-right":"5px"}},{default:n(()=>[a(m(le))]),_:1}),e[22]||(e[22]=r()),e[23]||(e[23]=s("span",{style:{"font-size":"large"}},"添加音频示例",-1))])]),s("div",Ot,[m(D)===void 0?(o(),i("button",{key:0,class:"next-btn",onClick:$e},"保存")):(o(),i("button",{key:1,class:"next-btn",onClick:Ne},"保存")),s("button",{class:"skip",onClick:Re},"跳过")])])])]),_:1})),a(Ee,{direction:"vertical",style:{height:"auto"}}),a(U,{span:11,class:"reactivity"},{default:n(()=>[a(dt)]),_:1})]),_:1})}}},es=re(qt,[["__scopeId","data-v-666c38d4"]]);export{es as default};
