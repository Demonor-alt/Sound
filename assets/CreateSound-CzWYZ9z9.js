import{_ as W,r as c,y as ce,a as r,z as n,o as a,d as s,B as V,b as o,I as O,J as K,c as N,w as l,A as x,e as d,f as m,C as Le,n as ae,N as G,R as Ee,p as Fe,q as je,S as Oe,u as qe,O as le,T as ne,U as Qe,V as He}from"./index-B_rCqBA3.js";import{t as Je}from"./time-tY07ncrd.js";import{u as re}from"./token-BnM9CpIp.js";import{c as Ke,e as Ge,f as We,g as Xe,h as Ye,i as Ze}from"./mybank-DSSsIs2D.js";import{M as L}from"./Input-O8HambgL.js";import{A as et}from"./AudioPlayer-Bc_EAwnV.js";import{i as tt}from"./request-6WSOmPiu.js";const st={key:0},ot={style:{"font-size":"18px","font-weight":"800","padding-bottom":"10px"}},at={class:"tag"},lt={style:{display:"flex","flex-direction":"row",gap:"10px"}},nt={style:{"font-weight":"520",color:"#71717a"}},it={__name:"Recent",setup(S){const y=c([{voiceId:70,voiceImage:"https://loremflickr.com/400/400?lock=567532027855895",voiceName:"曲志明",voiceDescription:"例面求上。果圆相称斗织是。开电年。同利算术极七等被来。问广十世。",voiceCreationTime:"2024-04-22 00:28:31",voiceIsCollected:!0,voiceSamples:[{sampleId:83,sampleIsPlaying:!1,sampleTitle:"拨伟大快但是脊梁",sampleText:"consectetur",sampleUrl:"https://nutritious-designation.com/"}]}]),C=re();return ce(async()=>{let b=await Ke(C.token.userId);y.value=b.data}),(b,f)=>{const h=r("el-empty"),U=r("el-image"),E=r("el-col"),v=r("el-tag"),q=r("el-icon"),A=r("el-row");return a(),n(O,null,[f[2]||(f[2]=s("h2",null,"最近活动",-1)),y.value.length===0?(a(),n("div",st,[o(h,{description:"暂无数据"})])):V("",!0),(a(!0),n(O,null,K(y.value,D=>(a(),N(A,{key:D.voiceId,class:"voice-item"},{default:l(()=>[o(E,{span:5,style:{display:"flex","align-items":"center","justify-content":"center"}},{default:l(()=>[o(U,{style:{width:"75px",height:"75px","border-radius":"10px"},src:D.voiceImage,fit:"cover"},null,8,["src"])]),_:2},1024),o(E,{span:19},{default:l(()=>[s("div",ot,x(D.voiceName),1),s("div",at,[o(v,{type:"success",round:"",effect:"dark",style:{width:"50px","font-weight":"1000"}},{default:l(()=>f[0]||(f[0]=[d("成功")])),_:1}),f[1]||(f[1]=s("div",{class:"dot"},null,-1)),s("div",lt,[o(q,{size:"20",style:{color:"#6b7280"}},{default:l(()=>[o(m(Le))]),_:1}),s("span",nt,x(m(Je)(D.voiceCreationTime)),1)])])]),_:2},1024)]),_:2},1024))),128))],64)}}},ct=W(it,[["__scopeId","data-v-e5c14140"]]),rt={class:"steps"},ie={__name:"Step",props:{currentStep:Number},setup(S){const y=S;return(C,b)=>{const f=r("el-divider");return a(),n("div",rt,[s("div",{class:ae(["step",{active:y.currentStep===1}])},"1",2),b[0]||(b[0]=s("div",{class:"detail"},[s("div",{class:"title"},"步骤1"),d(" 声音详情 ")],-1)),o(f,{class:"thick-divider"}),s("div",{class:ae(["step",{active:y.currentStep===2}])},"2",2),b[1]||(b[1]=s("div",{class:"detail"},[s("div",{class:"title"},"步骤2"),d(" 示例音频 ")],-1))])}}},ut={class:"info-container"},dt={key:0,class:"info-item"},pt={__name:"Store",setup(S){const y=c(["山区的瀑布，在长期的水流冲击下，下方形成深潭，潭水清澈且富含氧气，为多种鱼类和水生植物创造了适宜的生存环境，体现了自然现象产生的独特生态价值。","草原上的季节性河流，在枯水期形成的浅滩和湿地，吸引了大量候鸟在此停歇觅食，成为候鸟迁徙途中的重要补给站，表明自然的季节性变化能带来生态上的便利。","高山上的积雪，在春季融化后形成溪流，为山下的农田和森林提供了灌溉水源，滋养了众多生物，这显示出自然的冰雪循环对生态系统的重要滋养作用。","热带雨林中的暴雨，频繁的降水使土壤表面形成许多小水坑，这些水坑成为蛙类和小型水生生物的繁殖场所，说明自然降水能创造特定的生态繁衍环境。","北方冬季的大雪，积雪覆盖大地，为土壤起到保温作用，同时雪水融化后为春季植物生长提供水分，体现了自然降雪对生态的多重益处。","潮汐的涨落，在海岸边形成了潮间带，这里富含各种贝类和藻类，为许多涉禽提供了丰富的食物来源，表明自然的潮汐现象能构建独特的生态食物链。","石灰岩地区的溶洞，洞内独特的环境为蝙蝠提供了栖息和繁殖的场所，同时溶洞内的地下河也孕育了特殊的水生生物，说明自然的岩溶地貌能形成特殊的生态系统。","山顶的强风，使得树木生长形态扭曲，但这种独特的树形为一些鸟类提供了更好的筑巢支撑点，显示出自然环境对生态的意外塑造。","河流的改道，遗弃的旧河道形成了牛轭湖，牛轭湖为各种水生动植物提供了相对独立的生态空间，丰富了区域的生态多样性。","戈壁滩上的砾石，经过长时间的风化，表面形成一层黑色的“沙漠漆”，这种特殊的物质能吸收热量，为一些沙漠植物种子的萌发提供适宜温度，说明自然风化产物对生态有积极意义。","春季的沙尘暴，沙尘携带的矿物质在飘落后成为海洋浮游生物的重要养分，促进了海洋生态系统的初级生产力，体现了看似有害的自然现象背后的生态益处。","针叶林地区的落叶，在地面堆积腐烂后形成酸性土壤，这种土壤适合蓝莓等喜酸植物的生长，表明自然的落叶分解能营造特定的植物生长环境。","盐湖在干旱季节水分蒸发，盐分结晶析出，形成独特的盐滩景观，盐滩周边的特殊环境为耐盐植物和卤虫等生物提供了生存家园，说明自然的干湿变化能创造特殊生态。","山地的云雾，常常笼罩在山腰，为一些喜阴植物提供了湿润且凉爽的环境，使这些植物能在特定海拔区域良好生长，显示出自然云雾对生态的调节作用。","热带草原的野火，虽然烧毁部分草木，但也清除了地面的枯枝落叶，促进了新草的生长，同时吸引了食草动物前来觅食，带动了整个生态系统的活力，表明自然野火对生态有积极推动。","河流入海口的泥沙淤积，形成了广阔的河口三角洲，三角洲土地肥沃，为众多候鸟和鱼类提供了丰富的食物和栖息地，说明自然的泥沙堆积能创造重要的生态区域。","冻原地区的永冻层，在夏季部分融化，形成许多小的湿地和浅湖，为北极地区的鸟类和水禽提供了繁殖和觅食的场所，体现了自然冻土融化对生态的积极影响。"]);function C(h,U){return h=Math.ceil(h),U=Math.floor(U),Math.floor(Math.random()*(U-h+1))+h}const b=C(0,16),f=G(()=>y.value[b]||"");return(h,U)=>(a(),n("div",ut,[f.value?(a(),n("div",dt,x(f.value),1)):V("",!0)]))}},vt=W(pt,[["__scopeId","data-v-4ec65fdf"]]),mt=Ee("step",()=>{const S=c(1);function y(){S.value=2}function C(){S.value=1}return{step:S,incrementStep:y,reduceStep:C}}),ft=S=>tt.post("/common/audio",S),_t={class:"form-section"},yt={class:"radio"},gt={key:0,style:{"font-size":"small",color:"#6b748b"}},kt={key:1,style:{"font-size":"small",color:"#6b748b"}},bt={class:"form-section"},ht={class:"avatar"},St={class:"upload-box"},wt=["src"],It={class:"form-section"},Tt={class:"form-section"},Ct={class:"form-section"},Ut={key:0},zt={class:"audio-upload"},xt={class:"audio-player"},Dt={class:"audio-upload"},Mt={class:"size"},Rt=["onClick"],$t=["onClick"],Nt={class:"time-picker"},Vt={class:"loadHeader"},At={key:0,class:"icon"},Bt={key:1,class:"icon"},Pt={key:2,class:"icon"},Lt={key:2,class:"btnssecond"},Et={class:"audio-container"},Ft={class:"card-header"},jt={style:{"font-weight":"600"}},Ot={class:"myinput"},qt={class:"add-button-container"},Qt={class:"btnssecond"},Ht={__name:"CreateSound",setup(S){const y=re(),C=c("输入音频样本标题"),b=c("输入音频样本文本"),f=c("textarea"),h=c("#f5f5f5"),U=c("填写音频描述"),E=c("3"),v=c([{sampleId:"",sampleTitle:"",sampleText:"",sampleUrl:"",sampleIsPlaying:!1}]),q=()=>{v.value.push({sampleTitle:"",sampleText:"",sampleUrl:"",sampleIsPlaying:!1})},A=qe(),D=Fe(),B=D.query?D.query.id:void 0,ue=t=>{const e=v.value[t];e.audio&&(e.audio.pause(),e.audio.currentTime=0),v.value.splice(t,1)};function de(t,e){v.value[t].sampleTitle=e}function pe(t,e){v.value[t].sampleText=e}const g=c([]),F=c(!1),$=c(null),Q=c([]),X=c(),Y=c(),ve=async()=>{X.value=new Date;try{const t=await navigator.mediaDevices.getUserMedia({audio:!0});$.value=new MediaRecorder(t),Q.value=[],$.value.ondataavailable=e=>{e.data.size>0&&Q.value.push(e.data)},$.value.start(),F.value=!0,$.value.onstop=()=>{const e=new Blob(Q.value,{type:"audio/mp3"});e.value=e,F.value=!1,t.getTracks().forEach(i=>i.stop()),fe(e)}}catch(t){console.error("获取音频流失败：",t)}};function me(t,e){const i=new Date(t),w=new Date(e),_=Math.abs(w.getTime()-i.getTime());return Math.floor(_/1e3)}const fe=async t=>{Y.value=new Date;const e={name:`record-${g.value.length+1}.mp3`,url:URL.createObjectURL(t),blob:t,duration:`${me(X.value,Y.value)}s`,size:Z(t.size),file:new File([t],`record-${g.value.length+1}.mp3`,{type:"audio/mp3"})};g.value.unshift(e)},_e=()=>{$.value&&($.value.stop(),F.value=!1)},Z=t=>`${(t/1024).toFixed(2)} KB`,ye=t=>isNaN(t)||t===1/0?"未知":`${Math.floor(t)}s`,ge=async t=>{const e=URL.createObjectURL(t),i=new Audio(URL.createObjectURL(t));return await new Promise(w=>{i.addEventListener("loadedmetadata",()=>{const _=i.duration,P=ye(_),j={name:t.name,size:Z(t.size),duration:P,isPlaying:!1,url:e,file:t,actualDuration:_};g.value.push(j),w()})}),!1},k=je({}),ee=t=>{const e=g.value[t];k[t]||(k[t]=new Audio(e.url));const i=k[t];e.isPlaying?i.pause():(Object.entries(k).forEach(([w,_])=>{w!=t&&!_.paused&&(_.pause(),g.value[w].isPlaying=!1)}),i.play()),e.isPlaying=!e.isPlaying,i.addEventListener("ended",()=>{e.isPlaying=!1})},te=t=>{k[t]&&(k[t].pause(),k[t].src="",delete k[t]),g.value.splice(t,1)},ke=(t,e)=>{const i=e.value.findIndex(w=>w.name===t.name);i!==-1&&te(i)},se=c("first"),be=()=>{M.incrementStep()},T=G(()=>{let t=0;for(const e of g.value){const i=parseInt(e.duration.slice(0,-1),10);t+=i}return t}),he=G(()=>({10:{style:{color:"#9ca3b3",fontSize:"17px"},label:"最小"},30:{style:{color:"#9ca3b3",fontSize:"17px"},label:"推荐"},90:{style:{color:"#9ca3b3",fontSize:"17px"},label:"最大"}})),Se=c("填写声音名称"),we=c("输入标签");function Ie(t){p.value.voiceName=t}function Te(t){p.value.voiceDescription=t}function Ce(t){p.value.voiceTag=t}const M=mt(),{step:H}=Oe(M),J=c(""),p=c({voiceType:"1",voiceImage:"",voiceName:"",voiceDescription:"",voiceTag:""}),Ue=t=>{p.value.voiceImage=t.data},ze=async()=>{const t=new FormData;for(const e in p.value)t.append(e,p.value[e]);g.value.forEach(e=>{t.append("files",e.file)});for(const[e,i]of t.entries())console.log(`${e}:`,i);try{let e=await Ze(t);v.value=e.data.sample,J.value=e.data.voiceId,console.log("音频上传成功:",v.value,J.value)}catch(e){console.error("音频上传失败:",e)}},xe=async()=>{await ze(),g.value=[],Object.keys(k).forEach(t=>{k[t].pause(),k[t].src="",delete k[t]}),M.incrementStep()},De=()=>{A.push("/mybank"),M.reduceStep()},Me=async()=>{A.push("/mybank"),M.reduceStep();const t=v.value.slice(1);await Xe(t)},Re=async()=>{A.push("/mybank"),M.reduceStep();const t=v.value.slice(1);await Ye(t)},$e=async t=>{const e={voiceId:J.value,sampleText:v.value[t].sampleText};let i=await ft(e);v.value[t].sampleUrl=i.data};ce(async()=>{if(B!==void 0){let t=await Ge(B);p.value=t.data.insertData,v.value=t.data.samples}});const Ne=async()=>{await We(p.value),M.incrementStep()};return(t,e)=>{const i=r("el-radio-button"),w=r("el-radio-group"),_=r("el-icon"),P=r("el-upload"),j=r("el-tab-pane"),R=r("el-col"),oe=r("el-row"),Ve=r("el-tabs"),Ae=r("el-slider"),Be=r("el-button"),Pe=r("el-divider");return a(),N(oe,null,{default:l(()=>[m(H)===1?(a(),N(R,{key:0,span:12},{default:l(()=>[e[18]||(e[18]=s("h2",null,"训练新声音",-1)),o(ie,{currentStep:m(H)},null,8,["currentStep"]),s("div",null,[e[17]||(e[17]=s("h3",null,"声音详情",-1)),s("div",null,[s("div",_t,[e[3]||(e[3]=d(" 类型 ")),s("div",yt,[o(w,{modelValue:p.value.voiceType,"onUpdate:modelValue":e[0]||(e[0]=u=>p.value.voiceType=u),size:"large","text-color":"black",fill:"#fafafa"},{default:l(()=>[o(i,{label:"公开",value:"1"}),o(i,{label:"私有",value:"0"})]),_:1},8,["modelValue"])]),p.value.voiceType==="1"?(a(),n("div",gt," 此语音模型将在发现页面中可见，每个人都可以看到。 ")):(a(),n("div",kt,"此语音模型仅对创建者可见，不能共享且不会出现在发现页面。"))]),s("div",bt,[e[5]||(e[5]=d(" 封面图 (可选) ")),s("div",ht,[s("div",St,[o(P,{class:"avatar-uploader","auto-upload":!0,"show-file-list":!1,action:"/api/common/upload",name:"file",headers:{Authorization:m(y).token.token},"on-success":Ue},{default:l(()=>[p.value.voiceImage?(a(),n("img",{key:0,src:p.value.voiceImage,class:"avatar"},null,8,wt)):(a(),N(_,{key:1,class:"avatar-uploader-icon"},{default:l(()=>[o(m(le))]),_:1}))]),_:1},8,["headers"])]),e[4]||(e[4]=s("h4",null,"声音封面图片 (文件最大不超过 2MB)",-1))])]),s("div",It,[e[6]||(e[6]=d(" 名称 ")),o(L,{message:p.value.voiceName,placeholder:Se.value,class:"search-input",color:h.value,"onUpdate:message":Ie},null,8,["message","placeholder","color"])]),s("div",Tt,[e[7]||(e[7]=d(" 描述 (可选) ")),o(L,{message:p.value.voiceDescription,placeholder:U.value,color:h.value,type:f.value,"onUpdate:message":Te},null,8,["message","placeholder","color","type"])]),s("div",Ct,[e[8]||(e[8]=d(" 标签 ")),o(L,{message:p.value.voiceTag,placeholder:we.value,class:"search-input",color:h.value,"onUpdate:message":Ce},null,8,["message","placeholder","color"])])]),m(B)===void 0?(a(),n("div",Ut,[e[16]||(e[16]=s("h3",null,"输入音频",-1)),o(Ve,{modelValue:se.value,"onUpdate:modelValue":e[1]||(e[1]=u=>se.value=u),class:"demo-tabs"},{default:l(()=>[o(j,{label:"上传音频",name:"second"},{default:l(()=>[s("div",zt,[o(P,{class:"upload-component",accept:"audio/*","before-upload":ge,"file-list":g.value,"on-remove":ke,limit:0},{default:l(()=>e[9]||(e[9]=[s("div",{class:"upload-button"},[s("div",{class:"insert"}),s("h5",null,"添加或删除您的音频文件")],-1)])),_:1},8,["file-list"])])]),_:1}),o(j,{label:"录制音频",name:"first"},{default:l(()=>[s("div",xt,[F.value?(a(),n("div",{key:1,onClick:_e,class:"record"},e[11]||(e[11]=[s("div",{class:"noRecord"},null,-1),d(" 停止录制 ")]))):(a(),n("div",{key:0,onClick:ve,class:"record"},e[10]||(e[10]=[s("div",{class:"inRecord"},null,-1),d(" 点击开始录制 ")]))),e[12]||(e[12]=s("div",{style:{"font-size":"small",color:"#6b7280"}},"*您可以使用自己的文本或下面的建议文本录制您的声音。",-1)),o(vt)])]),_:1}),s("div",Dt,[(a(!0),n(O,null,K(g.value,(u,I)=>(a(),N(oe,{key:I,class:"files"},{default:l(()=>[o(R,{span:2,class:"logo"}),o(R,{span:13,class:"file"},{default:l(()=>[d(x(u.name)+" ",1),s("div",Mt,x(u.size),1)]),_:2},1024),o(R,{span:4},{default:l(()=>[d(x(u.duration),1)]),_:2},1024),o(R,{span:4,class:"btns"},{default:l(()=>[u.isPlaying?(a(),n("div",{key:1,class:"on",onClick:z=>ee(I)},null,8,$t)):(a(),n("div",{key:0,class:"close",onClick:z=>ee(I)},null,8,Rt)),o(_,{onClick:z=>te(I),class:"delete-btn",size:"25"},{default:l(()=>[o(m(ne))]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))])]),_:1},8,["modelValue"]),s("div",Nt,[s("div",Vt,[d(" 已上传："+x(T.value)+"s ",1),T.value<=90&&T.value>=10?(a(),n("div",At,[o(_,{size:"20",color:"#16a149"},{default:l(()=>[o(m(Qe))]),_:1}),e[13]||(e[13]=d(" 不错 "))])):V("",!0),T.value>90||T.value<10&&T.value>0?(a(),n("div",Bt,[o(_,{size:"20",color:"#ef4343"},{default:l(()=>[o(m(He))]),_:1}),e[14]||(e[14]=d(" 过长/过短 "))])):V("",!0),T.value===0?(a(),n("div",Pt," 推荐 30 秒左右 ")):V("",!0)]),o(Ae,{modelValue:T.value,"onUpdate:modelValue":e[2]||(e[2]=u=>T.value=u),min:"0",max:"100",step:1,"show-stops":"",marks:he.value,"show-tooltip":!1,"show-button":!1},null,8,["modelValue","marks"]),e[15]||(e[15]=s("div",{class:"tip"},"*提示：最短10秒，最长90秒，推荐30秒",-1))])])):V("",!0),m(B)===void 0?(a(),n("button",{key:1,class:"next-btn",onClick:xe},"创建")):(a(),n("div",Lt,[s("button",{class:"next-btn",onClick:Ne},"保存"),s("button",{class:"skip",onClick:be},"跳过")]))])]),_:1})):(a(),N(R,{key:1,span:12},{default:l(()=>[e[23]||(e[23]=s("h2",null,"训练新声音",-1)),o(ie,{currentStep:m(H)},null,8,["currentStep"]),s("div",null,[e[22]||(e[22]=s("h3",null,"音频样本",-1)),s("div",Et,[(a(!0),n(O,null,K(v.value,(u,I)=>(a(),n("div",{key:u.sampleId,class:"audio-card"},[s("div",null,[s("div",Ft,[s("span",jt,x(u.sampleTitle===""?"样本"+I:u.sampleTitle),1),o(_,{size:"20",color:"#606672",style:{cursor:"pointer"},onClick:z=>ue(I)},{default:l(()=>[o(m(ne))]),_:2},1032,["onClick"])])]),s("div",Ot,[o(L,{message:u.sampleTitle,placeholder:C.value,"onUpdate:message":z=>de(I,z)},null,8,["message","placeholder","onUpdate:message"]),o(L,{message:u.sampleText,placeholder:b.value,type:f.value,rows:E.value,"onUpdate:message":z=>pe(I,z)},null,8,["message","placeholder","type","rows","onUpdate:message"]),o(Be,{color:"#e7e7e8",onClick:z=>$e(I),style:{width:"16%","margin-left":"1%"}},{default:l(()=>e[19]||(e[19]=[s("div",{class:"make"},null,-1),d(" 生成样本 ")])),_:2},1032,["onClick"]),o(et,{audioUrl:u.sampleUrl},null,8,["audioUrl"])])]))),128)),s("div",qt,[s("button",{onClick:q,class:"add-btn"},[o(_,{size:"20",style:{"padding-right":"5px"}},{default:l(()=>[o(m(le))]),_:1}),e[20]||(e[20]=d()),e[21]||(e[21]=s("span",{style:{"font-size":"large"}},"添加音频示例",-1))])]),s("div",Qt,[m(B)===void 0?(a(),n("button",{key:0,class:"next-btn",onClick:Me},"保存")):(a(),n("button",{key:1,class:"next-btn",onClick:Re},"保存")),s("button",{class:"skip",onClick:De},"跳过")])])])]),_:1})),o(Pe,{direction:"vertical",style:{height:"auto"}}),o(R,{span:11,class:"reactivity"},{default:l(()=>[o(ct)]),_:1})]),_:1})}}},es=W(Ht,[["__scopeId","data-v-84187e36"]]);export{es as default};
