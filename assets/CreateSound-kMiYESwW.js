import{_ as J,u as de,r as c,B as ue,b as d,C as i,o,f as s,E as $,e as a,K as q,L as X,c as P,a as n,D,g as r,h as m,F as Fe,n as le,P as G,T as je,d as Oe,z as qe,U as Qe,Q as ne,V as ie,W as Ke,X as ce}from"./index-BvlRsYmY.js";import{t as He,M as We}from"./Select-p4l3ryjs.js";import{c as Xe,e as Ge,f as Je,g as Ye,h as Ze,i as et}from"./mybank-C4R6xdAz.js";import{M as E}from"./Input-BrKhoCfr.js";import{A as tt}from"./AudioPlayer-uUxlT9CJ.js";import"./request-C7XCKBec.js";import"./token-CgyZi0Qp.js";/* empty css                                                    */const st={key:0},at=["onClick"],ot={class:"tag"},lt={style:{display:"flex","flex-direction":"row",gap:"10px"}},nt={style:{"font-weight":"520",color:"#71717a"}},it={__name:"Recent",setup(T){const b=de(),C=y=>{b.push({path:"/detail",query:{id:y}})},g=c([{voiceId:70,voiceImage:"https://loremflickr.com/400/400?lock=567532027855895",voiceName:"曲志明",voiceDescription:"例面求上。果圆相称斗织是。开电年。同利算术极七等被来。问广十世。",voiceCreationTime:"2024-04-22 00:28:31",voiceIsCollected:!0,voiceSamples:[{sampleId:83,sampleIsPlaying:!1,sampleTitle:"拨伟大快但是脊梁",sampleText:"consectetur",sampleUrl:"https://nutritious-designation.com/"}]}]);return ue(async()=>{let y=await Xe();g.value=y.data}),(y,f)=>{const U=d("el-empty"),_=d("el-image"),F=d("el-col"),Q=d("el-tag"),K=d("el-icon"),B=d("el-row");return o(),i(q,null,[f[2]||(f[2]=s("h2",null,"最近活动",-1)),g.value.length===0?(o(),i("div",st,[a(U,{description:"暂无数据"})])):$("",!0),(o(!0),i(q,null,X(g.value,x=>(o(),P(B,{key:x.voiceId,class:"voice-item"},{default:n(()=>[a(F,{span:5,style:{display:"flex","align-items":"center","justify-content":"center"}},{default:n(()=>[a(_,{style:{width:"75px",height:"75px","border-radius":"10px"},src:x.voiceImage,fit:"cover"},null,8,["src"])]),_:2},1024),a(F,{span:19},{default:n(()=>[s("div",{style:{"font-size":"18px","font-weight":"800","padding-bottom":"10px",cursor:"pointer"},onClick:N=>C(x.voiceId)},D(x.voiceName),9,at),s("div",ot,[a(Q,{type:"success",round:"",effect:"dark",style:{width:"50px","font-weight":"1000"}},{default:n(()=>f[0]||(f[0]=[r("成功")])),_:1}),f[1]||(f[1]=s("div",{class:"dot"},null,-1)),s("div",lt,[a(K,{size:"20",style:{color:"#6b7280"}},{default:n(()=>[a(m(Fe))]),_:1}),s("span",nt,D(m(He)(x.voiceCreationTime)),1)])])]),_:2},1024)]),_:2},1024))),128))],64)}}},ct=J(it,[["__scopeId","data-v-858a627e"]]),rt={class:"steps"},re={__name:"Step",props:{currentStep:Number},setup(T){const b=T;return(C,g)=>{const y=d("el-divider");return o(),i("div",rt,[s("div",{class:le(["step",{active:b.currentStep===1}])},"1",2),g[0]||(g[0]=s("div",{class:"detail"},[s("div",{class:"title"},"步骤1"),r(" 声音详情 ")],-1)),a(y,{class:"thick-divider"}),s("div",{class:le(["step",{active:b.currentStep===2}])},"2",2),g[1]||(g[1]=s("div",{class:"detail"},[s("div",{class:"title"},"步骤2"),r(" 示例音频 ")],-1))])}}},dt={class:"info-container"},ut={key:0,class:"info-item"},pt={__name:"Store",setup(T){const b=c(["山区的瀑布，在长期的水流冲击下，下方形成深潭，潭水清澈且富含氧气，为多种鱼类和水生植物创造了适宜的生存环境，体现了自然现象产生的独特生态价值。","草原上的季节性河流，在枯水期形成的浅滩和湿地，吸引了大量候鸟在此停歇觅食，成为候鸟迁徙途中的重要补给站，表明自然的季节性变化能带来生态上的便利。","高山上的积雪，在春季融化后形成溪流，为山下的农田和森林提供了灌溉水源，滋养了众多生物，这显示出自然的冰雪循环对生态系统的重要滋养作用。","热带雨林中的暴雨，频繁的降水使土壤表面形成许多小水坑，这些水坑成为蛙类和小型水生生物的繁殖场所，说明自然降水能创造特定的生态繁衍环境。","北方冬季的大雪，积雪覆盖大地，为土壤起到保温作用，同时雪水融化后为春季植物生长提供水分，体现了自然降雪对生态的多重益处。","潮汐的涨落，在海岸边形成了潮间带，这里富含各种贝类和藻类，为许多涉禽提供了丰富的食物来源，表明自然的潮汐现象能构建独特的生态食物链。","石灰岩地区的溶洞，洞内独特的环境为蝙蝠提供了栖息和繁殖的场所，同时溶洞内的地下河也孕育了特殊的水生生物，说明自然的岩溶地貌能形成特殊的生态系统。","山顶的强风，使得树木生长形态扭曲，但这种独特的树形为一些鸟类提供了更好的筑巢支撑点，显示出自然环境对生态的意外塑造。","河流的改道，遗弃的旧河道形成了牛轭湖，牛轭湖为各种水生动植物提供了相对独立的生态空间，丰富了区域的生态多样性。","戈壁滩上的砾石，经过长时间的风化，表面形成一层黑色的“沙漠漆”，这种特殊的物质能吸收热量，为一些沙漠植物种子的萌发提供适宜温度，说明自然风化产物对生态有积极意义。","春季的沙尘暴，沙尘携带的矿物质在飘落后成为海洋浮游生物的重要养分，促进了海洋生态系统的初级生产力，体现了看似有害的自然现象背后的生态益处。","针叶林地区的落叶，在地面堆积腐烂后形成酸性土壤，这种土壤适合蓝莓等喜酸植物的生长，表明自然的落叶分解能营造特定的植物生长环境。","盐湖在干旱季节水分蒸发，盐分结晶析出，形成独特的盐滩景观，盐滩周边的特殊环境为耐盐植物和卤虫等生物提供了生存家园，说明自然的干湿变化能创造特殊生态。","山地的云雾，常常笼罩在山腰，为一些喜阴植物提供了湿润且凉爽的环境，使这些植物能在特定海拔区域良好生长，显示出自然云雾对生态的调节作用。","热带草原的野火，虽然烧毁部分草木，但也清除了地面的枯枝落叶，促进了新草的生长，同时吸引了食草动物前来觅食，带动了整个生态系统的活力，表明自然野火对生态有积极推动。","河流入海口的泥沙淤积，形成了广阔的河口三角洲，三角洲土地肥沃，为众多候鸟和鱼类提供了丰富的食物和栖息地，说明自然的泥沙堆积能创造重要的生态区域。","冻原地区的永冻层，在夏季部分融化，形成许多小的湿地和浅湖，为北极地区的鸟类和水禽提供了繁殖和觅食的场所，体现了自然冻土融化对生态的积极影响。"]);function C(f,U){return f=Math.ceil(f),U=Math.floor(U),Math.floor(Math.random()*(U-f+1))+f}const g=C(0,16),y=G(()=>b.value[g]||"");return(f,U)=>(o(),i("div",dt,[y.value?(o(),i("div",ut,D(y.value),1)):$("",!0)]))}},vt=J(pt,[["__scopeId","data-v-4ec65fdf"]]),mt=je("step",()=>{const T=c(1);function b(){T.value=2}function C(){T.value=1}return{step:T,incrementStep:b,reduceStep:C}}),ft={class:"form-section"},_t={class:"radio"},gt={key:0,style:{"font-size":"small",color:"#6b748b"}},yt={key:1,style:{"font-size":"small",color:"#6b748b"}},kt={class:"form-section"},ht={class:"avatar"},bt={class:"upload-box"},St=["src"],wt={class:"form-section"},It={class:"form-section"},Tt={class:"form-section"},Ct={class:"form-section"},Ut={key:0},xt={class:"audio-upload"},zt={class:"audio-player"},Dt={class:"audio-upload"},Mt={class:"size"},Rt=["onClick"],$t=["onClick"],Nt={class:"time-picker"},Vt={class:"loadHeader"},Pt={key:0,class:"icon"},Bt={key:1,class:"icon"},Lt={key:2,class:"icon"},At={key:3,class:"icon"},Et={key:2,class:"btnssecond"},Ft={class:"audio-container"},jt={class:"card-header"},Ot={style:{"font-weight":"600"}},qt={class:"myinput"},Qt={class:"add-button-container"},Kt={class:"btnssecond"},Ht={__name:"CreateSound",setup(T){const b=c("输入音频样本标题"),C=c("输入音频样本文本"),g=c("textarea"),y=c("#fafafa"),f=c("填写音频描述"),U=c("3"),_=c([{sampleId:"",sampleTitle:"",sampleText:"",sampleUrl:"",sampleIsPlaying:!1}]),F=()=>{_.value.push({sampleTitle:"",sampleText:"",sampleUrl:"",sampleIsPlaying:!1})},Q=c([{value:"1",label:"中文"},{value:"2",label:"English"}]),K=t=>{p.value.voiceLanguage=parseInt(t,10)},B=de(),x=Oe(),N=x.query?x.query.id:void 0,pe=t=>{const e=_.value[t];e.audio&&(e.audio.pause(),e.audio.currentTime=0),_.value.splice(t,1)};function ve(t,e){_.value[t].sampleTitle=e}function me(t,e){_.value[t].sampleText=e}const k=c([]),j=c(!1),V=c(null),H=c([]),Y=c(),Z=c(),fe=async()=>{Y.value=new Date;try{const t=await navigator.mediaDevices.getUserMedia({audio:!0});V.value=new MediaRecorder(t),H.value=[],V.value.ondataavailable=e=>{e.data.size>0&&H.value.push(e.data)},V.value.start(),j.value=!0,V.value.onstop=()=>{const e=new Blob(H.value,{type:"audio/mp3"});e.value=e,j.value=!1,t.getTracks().forEach(l=>l.stop()),ge(e)}}catch(t){console.error("获取音频流失败：",t)}};function _e(t,e){const l=new Date(t),S=new Date(e),v=Math.abs(S.getTime()-l.getTime());return Math.floor(v/1e3)}const ge=async t=>{Z.value=new Date;const e={name:`record-${k.value.length+1}.mp3`,url:URL.createObjectURL(t),blob:t,duration:`${_e(Y.value,Z.value)}s`,size:ee(t.size),file:new File([t],`record-${k.value.length+1}.mp3`,{type:"audio/mp3"})};k.value.unshift(e)},ye=()=>{V.value&&(V.value.stop(),j.value=!1)},ee=t=>`${(t/1024).toFixed(2)} KB`,ke=t=>isNaN(t)||t===1/0?"未知":`${Math.floor(t)}s`,he=async t=>{const e=URL.createObjectURL(t),l=new Audio(URL.createObjectURL(t));return await new Promise(S=>{l.addEventListener("loadedmetadata",()=>{const v=l.duration,A=ke(v),O={name:t.name,size:ee(t.size),duration:A,isPlaying:!1,url:e,file:t,actualDuration:v};k.value.push(O),S()})}),!1},h=qe({}),te=t=>{const e=k.value[t];h[t]||(h[t]=new Audio(e.url));const l=h[t];e.isPlaying?l.pause():(Object.entries(h).forEach(([S,v])=>{S!=t&&!v.paused&&(v.pause(),k.value[S].isPlaying=!1)}),l.play()),e.isPlaying=!e.isPlaying,l.addEventListener("ended",()=>{e.isPlaying=!1})},se=t=>{h[t]&&(h[t].pause(),h[t].src="",delete h[t]),k.value.splice(t,1)},be=(t,e)=>{const l=e.value.findIndex(S=>S.name===t.name);l!==-1&&se(l)},ae=c("second"),Se=()=>{M.incrementStep()},I=G(()=>{let t=0;for(const e of k.value){const l=parseInt(e.duration.slice(0,-1),10);t+=l}return t}),we=G(()=>({10:{style:{color:"#9ca3b3",fontSize:"17px"},label:"最小"},30:{style:{color:"#9ca3b3",fontSize:"17px"},label:"推荐"},90:{style:{color:"#9ca3b3",fontSize:"17px"},label:"最大"}})),Ie=c("填写声音名称"),Te=c("输入标签");function Ce(t){p.value.voiceName=t}function Ue(t){p.value.voiceDescription=t}function xe(t){p.value.voiceTag=t}const M=mt(),{step:W}=Qe(M),L=c(""),p=c({voiceType:"1",voiceImage:"",voiceName:"",voiceDescription:"",voiceTag:"",voiceLanguage:1}),ze=t=>{p.value.voiceImage=t.data.voiceImage},De=async()=>{const t=new FormData;k.value.forEach(l=>{console.log(l),t.append("audio_file",l)}),console.log(t);const e=new FormData;e.append("text","1111"),e.append("text_lang","zh"),e.append("prompt_lang","zh"),k.value.forEach(l=>{e.append("ref_audio",loadResult)});try{let l=await et(e);console.log(l),_.value=l.data.sample,L.value=l.data.voiceId,console.log("音频上传成功:",_.value,L.value)}catch(l){console.error("音频上传失败:",l)}},Me=async()=>{await De(),k.value=[],Object.keys(h).forEach(t=>{h[t].pause(),h[t].src="",delete h[t]}),M.incrementStep()},Re=()=>{B.push("/mybank"),M.reduceStep()},$e=async()=>{B.push("/mybank"),M.reduceStep();const t=_.value.slice(1),e={voiceId:L.value,samples:t};await Ye(e)},Ne=async()=>{B.push("/mybank"),M.reduceStep();const t=_.value.slice(1);await Ze(t)},Ve=async t=>{L.value,_.value[t].sampleText};ue(async()=>{if(N!==void 0){let t=await Ge(N);p.value=t.data,_.value=t.data.voiceSamples}});const Pe=async()=>{({...p,voiceId:L.value},await Je(p.value)),M.incrementStep()};return(t,e)=>{const l=d("el-radio-button"),S=d("el-radio-group"),v=d("el-icon"),A=d("el-upload"),O=d("el-tab-pane"),R=d("el-col"),oe=d("el-row"),Be=d("el-tabs"),Le=d("el-slider"),Ae=d("el-button"),Ee=d("el-divider");return o(),P(oe,null,{default:n(()=>[m(W)===1?(o(),P(R,{key:0,span:12},{default:n(()=>[e[20]||(e[20]=s("h2",null,"训练新声音",-1)),a(re,{currentStep:m(W)},null,8,["currentStep"]),s("div",null,[e[19]||(e[19]=s("h3",null,"声音详情",-1)),s("div",null,[s("div",ft,[e[3]||(e[3]=r(" 类型 ")),s("div",_t,[a(S,{modelValue:p.value.voiceType,"onUpdate:modelValue":e[0]||(e[0]=u=>p.value.voiceType=u),size:"large","text-color":"black",fill:"#fafafa"},{default:n(()=>[a(l,{label:"公开",value:"1"}),a(l,{label:"私有",value:"0"})]),_:1},8,["modelValue"])]),p.value.voiceType==="1"?(o(),i("div",gt," 此语音模型将在发现页面中可见，每个人都可以看到。 ")):(o(),i("div",yt,"此语音模型仅对创建者可见，不能共享且不会出现在发现页面。"))]),s("div",kt,[e[5]||(e[5]=r(" 封面图 (可选) ")),s("div",ht,[s("div",bt,[a(A,{class:"avatar-uploader","auto-upload":!0,"show-file-list":!1,action:"/api/common/upload",name:"file","on-success":ze},{default:n(()=>[p.value.voiceImage?(o(),i("img",{key:0,src:p.value.voiceImage,class:"avatar"},null,8,St)):(o(),P(v,{key:1,class:"avatar-uploader-icon"},{default:n(()=>[a(m(ne))]),_:1}))]),_:1})]),e[4]||(e[4]=s("h4",null,"声音封面图片 (文件最大不超过 2MB)",-1))])]),s("div",wt,[e[6]||(e[6]=r(" 名称 ")),a(E,{message:p.value.voiceName,placeholder:Ie.value,class:"search-input",color:y.value,"onUpdate:message":Ce},null,8,["message","placeholder","color"])]),s("div",It,[e[7]||(e[7]=r(" 描述 (可选) ")),a(E,{message:p.value.voiceDescription,placeholder:f.value,color:y.value,type:g.value,"onUpdate:message":Ue},null,8,["message","placeholder","color","type"])]),s("div",Tt,[e[8]||(e[8]=r(" 标签 ")),a(E,{message:p.value.voiceTag,placeholder:Te.value,class:"search-input",color:y.value,"onUpdate:message":xe},null,8,["message","placeholder","color"])]),s("div",Ct,[e[9]||(e[9]=r(" 语言 ")),a(We,{options:Q.value,"input-width":"655px",color:"#fafafa","onUpdate:value":K},null,8,["options"])])]),m(N)===void 0?(o(),i("div",Ut,[e[18]||(e[18]=s("h3",null,"输入音频",-1)),a(Be,{modelValue:ae.value,"onUpdate:modelValue":e[1]||(e[1]=u=>ae.value=u),class:"demo-tabs"},{default:n(()=>[a(O,{label:"上传音频",name:"second"},{default:n(()=>[s("div",xt,[a(A,{class:"upload-component",accept:"audio/*","before-upload":he,"show-file-list":!1,"file-list":k.value,"on-remove":be,limit:0},{default:n(()=>e[10]||(e[10]=[s("div",{class:"upload-button"},[s("div",{class:"insert"}),s("h5",null,"添加或删除您的音频文件")],-1)])),_:1},8,["file-list"])])]),_:1}),a(O,{label:"录制音频",name:"first"},{default:n(()=>[s("div",zt,[j.value?(o(),i("div",{key:1,onClick:ye,class:"record"},e[12]||(e[12]=[s("div",{class:"noRecord"},null,-1),r(" 停止录制 ")]))):(o(),i("div",{key:0,onClick:fe,class:"record"},e[11]||(e[11]=[s("div",{class:"inRecord"},null,-1),r(" 点击开始录制 ")]))),e[13]||(e[13]=s("div",{style:{"font-size":"small",color:"#6b7280","margin-left":"20px"}}," *您可以使用自己的文本或下面的建议文本录制您的声音。",-1)),a(vt)])]),_:1}),s("div",Dt,[(o(!0),i(q,null,X(k.value,(u,w)=>(o(),P(oe,{key:w,class:"files"},{default:n(()=>[a(R,{span:2,class:"logo"}),a(R,{span:13,class:"file"},{default:n(()=>[r(D(u.name)+" ",1),s("div",Mt,D(u.size),1)]),_:2},1024),a(R,{span:4},{default:n(()=>[r(D(u.duration),1)]),_:2},1024),a(R,{span:4,class:"btns"},{default:n(()=>[u.isPlaying?(o(),i("div",{key:1,class:"on",onClick:z=>te(w)},null,8,$t)):(o(),i("div",{key:0,class:"close",onClick:z=>te(w)},null,8,Rt)),a(v,{onClick:z=>se(w),class:"delete-btn",size:"25"},{default:n(()=>[a(m(ie))]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))])]),_:1},8,["modelValue"]),s("div",Nt,[s("div",Vt,[r(" 已上传："+D(I.value)+"s ",1),I.value<=90&&I.value>=10?(o(),i("div",Pt,[a(v,{size:"20",color:"#16a149"},{default:n(()=>[a(m(Ke))]),_:1}),e[14]||(e[14]=r(" 不错 "))])):$("",!0),I.value>90?(o(),i("div",Bt,[a(v,{size:"20",color:"#ef4343"},{default:n(()=>[a(m(ce))]),_:1}),e[15]||(e[15]=r(" 过长 "))])):$("",!0),I.value<10&&I.value>0?(o(),i("div",Lt,[a(v,{size:"20",color:"#ef4343"},{default:n(()=>[a(m(ce))]),_:1}),e[16]||(e[16]=r(" 过短 "))])):$("",!0),I.value===0?(o(),i("div",At," 推荐 30 秒左右 ")):$("",!0)]),a(Le,{modelValue:I.value,"onUpdate:modelValue":e[2]||(e[2]=u=>I.value=u),min:"0",max:"100",step:1,"show-stops":"",marks:we.value,"show-tooltip":!1,"show-button":!1},null,8,["modelValue","marks"]),e[17]||(e[17]=s("div",{class:"tip"},"*提示：最短10秒，最长90秒，推荐30秒",-1))])])):$("",!0),m(N)===void 0?(o(),i("button",{key:1,class:"next-btn",onClick:Me},"创建")):(o(),i("div",Et,[s("button",{class:"next-btn",onClick:Pe},"保存"),s("button",{class:"skip",onClick:Se},"跳过")]))])]),_:1})):(o(),P(R,{key:1,span:12},{default:n(()=>[e[25]||(e[25]=s("h2",null,"训练新声音",-1)),a(re,{currentStep:m(W)},null,8,["currentStep"]),s("div",null,[e[24]||(e[24]=s("h3",null,"音频样本",-1)),s("div",Ft,[(o(!0),i(q,null,X(_.value,(u,w)=>(o(),i("div",{key:u.sampleId,class:"audio-card"},[s("div",null,[s("div",jt,[s("span",Ot,D(u.sampleTitle===""?"样本"+w:u.sampleTitle),1),a(v,{size:"20",color:"#606672",style:{cursor:"pointer"},onClick:z=>pe(w)},{default:n(()=>[a(m(ie))]),_:2},1032,["onClick"])])]),s("div",qt,[a(E,{message:u.sampleTitle,placeholder:b.value,"onUpdate:message":z=>ve(w,z)},null,8,["message","placeholder","onUpdate:message"]),a(E,{message:u.sampleText,placeholder:C.value,type:g.value,rows:U.value,"onUpdate:message":z=>me(w,z)},null,8,["message","placeholder","type","rows","onUpdate:message"]),a(Ae,{color:"#e7e7e8",onClick:z=>Ve(w),style:{width:"16%","margin-left":"1%"}},{default:n(()=>e[21]||(e[21]=[s("div",{class:"make"},null,-1),r(" 生成样本 ")])),_:2},1032,["onClick"]),a(tt,{audioUrl:u.sampleUrl},null,8,["audioUrl"])])]))),128)),s("div",Qt,[s("button",{onClick:F,class:"add-btn"},[a(v,{size:"20",style:{"padding-right":"5px"}},{default:n(()=>[a(m(ne))]),_:1}),e[22]||(e[22]=r()),e[23]||(e[23]=s("span",{style:{"font-size":"large"}},"添加音频示例",-1))])]),s("div",Kt,[m(N)===void 0?(o(),i("button",{key:0,class:"next-btn",onClick:$e},"保存")):(o(),i("button",{key:1,class:"next-btn",onClick:Ne},"保存")),s("button",{class:"skip",onClick:Re},"跳过")])])])]),_:1})),a(Ee,{direction:"vertical",style:{height:"auto"}}),a(R,{span:11,class:"reactivity"},{default:n(()=>[a(ct)]),_:1})]),_:1})}}},ss=J(Ht,[["__scopeId","data-v-9eaf7f79"]]);export{ss as default};
